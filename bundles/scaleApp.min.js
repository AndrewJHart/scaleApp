(function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O=[].slice,P={}.hasOwnProperty,Q=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1};i=function(a){var b,c,d;if(a instanceof Array)b=function(){var b,c,e;e=[];for(b=0,c=a.length;b<c;b++)d=a[b],e.push(d);return e}();else{b={};for(c in a)d=a[c],b[c]=d}return b},String.prototype.trim==null&&(String.prototype.trim=function(){return this.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}),o=function(a){var b,c,d,e,f;a==null&&(a=function(){}),c=a.toString().match(/function[^(]*\(([^)]*)\)/);if(c==null||c.length<2)return[];c=c[1],c=c.split(/\s*,\s*/),f=[];for(d=0,e=c.length;d<e;d++)b=c[d],b.trim()!==""&&f.push(b);return f},J=function(a){var b;a==null&&(a=8),b="";while(b.length<a)b+=Math.random().toString(36).substr(2);return b.substr(0,a)},B=function(a,b,c){var d,e,f,g,h,i,j,k,l;a==null&&(a=[]),b==null&&(b=function(){}),e=a.length,h=[];if(e===0)return typeof b=="function"?b(null,h):void 0;f=[],d=function(){var a;e--;if(e===0)return function(){var b,c,d;d=[];for(b=0,c=f.length;b<c;b++)a=f[b],a!=null&&d.push(a);return d}().length>0?b(f,h):b(null,h)},l=[];for(g=j=0,k=a.length;j<k;g=++j)i=a[g],l.push(function(a,b){var e;e=function(){var a,c;return a=arguments[0],c=2<=arguments.length?O.call(arguments,1):[],a!=null?(f[b]=a,h[b]=void 0):h[b]=c.length<2?c[0]:c,d()};try{return a(e)}catch(g){if(c)return e(g)}}(i,g));return l},C=function(a,b){var c,d;return c=-1,a.length===0?b():(d=function(){var e,f;return e=arguments[0],f=2<=arguments.length?O.call(arguments,1):[],e!=null?b(e):++c===a.length?b.apply(null,[null].concat(O.call(f))):a[c].apply(a,O.call(f).concat([d]))},d())},m=function(a,b,c){var d,e;return a==null&&(a=[]),e=function(){var c,e,f;f=[];for(c=0,e=a.length;c<e;c++)d=a[c],f.push(function(a){return function(c){return b(a,c)}}(d));return f}(),M.runSeries(e,c)},M={doForAll:m,runSeries:B,runWaterfall:C,clone:i,getArgumentNames:o,uniqueId:J},(typeof module!=="undefined"&&module!==null?module.exports:void 0)!=null&&(module.exports=M),(typeof module!=="undefined"&&module!==null?module.exports:void 0)!=null&&typeof require=="function"&&(M=require("./Util")),b=function(){function a(a,b){this.cascadeChannels=b!=null?b:!1,this.channels={},a&&this.installTo(a)}return a.prototype.subscribe=function(b,c,d){var e,f,g,h,i,j,k,l,m,n,o;d==null&&(d=this),(m=(j=this.channels)[b])==null&&(j[b]=[]),h=this;if(b instanceof Array){n=[];for(k=0,l=b.length;k<l;k++)e=b[k],n.push(this.subscribe(e,c,d));return n}if(typeof b=="object"){o=[];for(f in b)i=b[f],o.push(this.subscribe(f,i,c));return o}return typeof c!="function"?!1:typeof b!="string"?!1:(g={context:d,callback:c},{attach:function(){return h.channels[b].push(g),this},detach:function(){return a._rm(h,b,g.callback),this}}.attach())},a.prototype.on=a.prototype.subscribe,a.prototype.unsubscribe=function(b,c){var d;switch(typeof b){case"string":typeof c=="function"&&a._rm(this,b,c),typeof c=="undefined"&&a._rm(this,b);break;case"function":for(d in this.channels)a._rm(this,d,b);break;case"undefined":for(d in this.channels)a._rm(this,d);break;case"object":for(d in this.channels)a._rm(this,d,null,b)}return this},a.prototype.publish=function(a,b,c){var d,e,f,g,h;return c==null&&(c={}),typeof b=="function"&&(c=b,b=void 0),typeof a!="string"?!1:(g=this.channels[a]||[],typeof b=="object"&&c.publishReference!==!0&&(e=M.clone(b)),h=function(){var c,d,h;h=[];for(c=0,d=g.length;c<d;c++)f=g[c],h.push(function(c){return function(d){try{return M.getArgumentNames(c.callback).length>=3?c.callback.apply(c.context,[e||b,a,d]):d(null,c.callback.apply(c.context,[e||b,a]))}catch(f){return d(f)}}}(f));return h}(),M.runSeries(h,function(a,b){var d,e;return a&&(d=new Error(function(){var b,c,d;d=[];for(b=0,c=a.length;b<c;b++)e=a[b],e!=null&&d.push(e.message);return d}().join("; "))),typeof c=="function"?c(d):void 0},!0),this.cascadeChannels&&(d=a.split("/")).length>1&&this.publish(d.slice(0,-1).join("/"),b,c),this)},a.prototype.emit=a.prototype.publish,a.prototype.installTo=function(a){var b,c;if(typeof a=="object")for(b in this)c=this[b],a[b]=c;return this},a._rm=function(a,b,c,d){var e;return a.channels[b]=function(){var f,g,h,i;h=a.channels[b],i=[];for(f=0,g=h.length;f<g;f++)e=h[f],(c!=null?e.callback!==c:d!=null?e.context!==d:e.context!==a)&&i.push(e);return i}()},a}(),(typeof module!=="undefined"&&module!==null?module.exports:void 0)!=null&&(module.exports=b),e=function(){function a(a,b,c){this.core=a,this.instanceId=b,this.options=c!=null?c:{};if(this.core==null)throw new TypeError("core was not defined");if(b==null)throw new TypeError("no id was specified");if(typeof b!="string")throw new TypeError("id is not a string")}return a}(),(typeof module!=="undefined"&&module!==null?module.exports:void 0)!=null&&(module.exports=e),f="0.3.8",a="function",d="string",c="object",h=function(a,b,c){if(typeof b!==a)throw new TypeError(""+c+" has to be a "+a)},(typeof module!=="undefined"&&module!==null?module.exports:void 0)!=null&&typeof require===a&&require.amd==null&&(b=require("./Mediator"),e=require("./Sandbox"),M=require("./Util")),v={},r={},q={},u=new b,y={},n=function(a){return typeof console!="undefined"&&console!==null?typeof console.error=="function"?console.error(a.message):void 0:void 0},x={_always:[]},w=function(b,c){var e;h(a,b,"parameter"),e={context:this,callback:b};if(typeof c===d)return x[c]==null&&(x[c]=[]),x[c].push(e);if(c==null)return x._always.push(e)},p=function(a,b,c){var d,e,f,g,h;f={},h=b.options;for(e in h)g=h[e],f[e]=g;d=q[a];if(d)for(e in d)g=d[e],f[e]=g;if(c)for(e in c)g=c[e],f[e]=g;return f},l=function(a,b,c){var d,f,g,h,i,k,l,m,n,o,q,s,t,w,z,A,B;b==null&&(b=a),k=v[a];if(r[b]!=null)return r[b];g=p(b,k,c),o=new e(j,b,g),u.installTo(o);for(f in y){m=y[f];if(m.sandbox==null)continue;n=new m.sandbox(o);for(i in n){if(!P.call(n,i))continue;q=n[i],o[i]=q}}h=new k.creator(o),h.options=g,h.id=b,r[b]=h,A=[b,"_always"];for(s=0,w=A.length;s<w;s++){l=A[s];if(x[l]!=null){B=x[l];for(t=0,z=B.length;t<z;t++)d=B[t],d.callback.apply(d.context)}}return h},g=function(b,e,f){var g;h(d,b,"module ID"),h(a,e,"creator"),h(c,f,"option parameter"),g=new e,h(c,g,"the return value of the creator"),h(a,g.init,"'init' of the module"),h(a,g.destroy,"'destroy' of the module ");if(v[b]!=null)throw new TypeError("module "+b+" was already registered");return v[b]={creator:e,options:f,id:b},!0},z=function(a,b,c){c==null&&(c={});try{return g(a,b,c)}catch(d){return n(new Error("could not register module '"+a+"': "+d.message)),!1}},E=function(a,b){var e,f,g,i;h(d,a,"instance ID"),h(c,b,"option parameter"),(g=q[a])==null&&(q[a]={}),i=[];for(e in b)f=b[e],i.push(q[a][e]=f);return i},K=function(a,b){return b[a]!=null?(delete b[a],!0):!1},L=function(a){var b,c;c=[];for(b in a)c.push(K(b,a));return c},F=function(a,b){var e;b==null&&(b={});try{h(d,a,"module ID"),h(c,b,"second parameter");if(v[a]==null)throw new Error("module doesn't exist");e=l(a,b.instanceId,b.options);if(e.running===!0)throw new Error("module was already started");return M.getArgumentNames(e.init).length>=2?e.init(e.options,function(a){return typeof b.callback=="function"?b.callback(a):void 0}):(e.init(e.options),typeof b.callback=="function"&&b.callback(null)),e.running=!0,!0}catch(f){return n(f),typeof b.callback=="function"&&b.callback(new Error("could not start module: "+f.message)),!1}},H=function(a,b){var c;return(c=r[a])?(u.unsubscribe(c),M.getArgumentNames(c.destroy).length>=1?c.destroy(function(a){return typeof b=="function"?b(a):void 0}):(c.destroy(),typeof b=="function"&&b(null)),delete r[a],!0):!1},G=function(a,b){var c,d,e,f,g,h,i;return a instanceof Array?(f=a,a=b,b=null,h=function(){var a,b,d;d=[];for(a=0,b=f.length;a<b;a++)c=f[a],v[c]!=null&&d.push(c);return d}()):f=h=function(){var a;a=[];for(c in v)a.push(c);return a}(),h.length===(i=f.length)&&i===0?(typeof a=="function"&&a(null),!0):(h.length!==f.length&&(d=function(){var a,b,d;d=[];for(a=0,b=f.length;a<b;a++)c=f[a],Q.call(h,c)>=0||d.push("'"+c+"'");return d}(),e=new Error("these modules don't exist: "+d)),g=function(a,b){var c,d,e,f;e={},d=v[a].options;for(c in d){if(!P.call(d,c))continue;f=d[c],f&&(e[c]=f)}return e.callback=function(a){return typeof d.callback=="function"&&d.callback(a),b(a)},F(a,e)},M.doForAll(h,g,function(b){var c,d,f;return(b!=null?b.length:void 0)>0&&(c=new Error("errors occoured in the following modules: "+function(){var a,c,e;e=[];for(d=a=0,c=b.length;a<c;d=++a)f=b[d],f!=null&&e.push("'"+h[d]+"'");return e}())),typeof a=="function"?a(c||e):void 0}),e==null)},I=function(a){var b;return M.doForAll(function(){var a;a=[];for(b in r)a.push(b);return a}(),H,a)},D=["core","instanceId","options","publish","emit","on","subscribe","unsubscribe"],t=function(a){var b,c,d;d=[];for(b in a)c=a[b],d.push(b);return d},A=function(b){var f,g,i,l,m;f=new Error("plugin uses reserved keyword");try{h(c,b,"plugin"),h(d,b.id,"'id' of plugin");if(typeof b.sandbox===a){for(g in new b.sandbox(new e(j,"")))if(Q.call(D,g)>=0)throw f;l=b.sandbox.prototype;for(g in l)i=l[g],e.prototype[g]=i}if(typeof b.core===c){for(g in b.core)if(Q.call(k,g)>=0)throw f;m=b.core;for(g in m)i=m[g],j[g]=i,typeof exports!="undefined"&&exports!==null&&(exports[g]=i)}return typeof b.onInstantiate===a&&w(b.onInstantiate),y[b.id]=b,!0}catch(o){return n(o),!1}},j={VERSION:f,register:z,unregister:function(a){return K(a,v)},unregisterAll:function(){return L(v)},registerPlugin:A,unregisterPlugin:function(a){return K(a,y)},unregisterAllPlugins:function(){return L(y)},setInstanceOptions:E,start:F,stop:H,startAll:G,stopAll:I,uniqueId:M.uniqueId,lsInstances:function(){return t(r)},lsModules:function(){return t(v)},lsPlugins:function(){return t(y)},util:M,Mediator:b,Sandbox:e,subscribe:function(){return u.subscribe.apply(u,arguments)},on:function(){return u.subscribe.apply(u,arguments)},unsubscribe:function(){return u.unsubscribe.apply(u,arguments)},publish:function(){return u.publish.apply(u,arguments)},emit:function(){return u.publish.apply(u,arguments)}},k=function(){var a;a=[];for(s in j)N=j[s],a.push(s);return a}(),(typeof module!=="undefined"&&module!==null?module.exports:void 0)!=null&&(module.exports=j),(typeof define!=="undefined"&&define!==null?define.amd:void 0)!=null?(typeof define!=="undefined"&&define!==null?define.amd:void 0)!=null&&define(function(){return j}):typeof window!="undefined"&&window!==null&&(window.scaleApp=j)}).call(this);