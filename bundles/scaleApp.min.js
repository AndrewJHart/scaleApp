(function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G={}.hasOwnProperty,H=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1};f=function(a){var b,c,d;if(a instanceof Array)b=function(){var b,c,e;e=[];for(b=0,c=a.length;b<c;b++)d=a[b],e.push(d);return e}();else{b={};for(c in a)d=a[c],b[c]=d}return b},a=function(){function a(a,b){this.cascadeChannels=b!=null?b:!1,this.channels={},a&&this.installTo(a)}return a.getArgumentNames=function(a){var b,c,d,e,f;c=a.toString().match(/function[^(]*\(([^)]*)\)/);if(c==null||c.length<2)return[];c=c[1],c=c.split(/\s*,\s*/),f=[];for(d=0,e=c.length;d<e;d++)b=c[d],b.trim()!==""&&f.push(b);return f},a.prototype.subscribe=function(b,c,d){var e,f,g,h,i,j,k,l,m,n,o;d==null&&(d=this),(m=(j=this.channels)[b])==null&&(j[b]=[]),h=this;if(b instanceof Array){n=[];for(k=0,l=b.length;k<l;k++)e=b[k],n.push(this.subscribe(e,c,d));return n}if(typeof b=="object"){o=[];for(f in b)i=b[f],o.push(this.subscribe(f,i,c));return o}return typeof c!="function"?!1:typeof b!="string"?!1:(g={context:d,callback:c},{attach:function(){return h.channels[b].push(g),this},detach:function(){return a._rm(h,b,g.callback),this}}.attach())},a.prototype.on=a.prototype.subscribe,a.prototype.unsubscribe=function(b,c){var d;switch(typeof b){case"string":typeof c=="function"&&a._rm(this,b,c),typeof c=="undefined"&&a._rm(this,b);break;case"function":for(d in this.channels)a._rm(this,d,b);break;case"undefined":for(d in this.channels)a._rm(this,d);break;case"object":for(d in this.channels)a._rm(this,d,null,b)}return this},a.prototype.publish=function(b,c,d){var e,g,h,i,j,k,l,m,n,o,p,q;d==null&&(d={});if(this.channels[b]!=null){e=[],k=[],j=this.channels[b].length,l=function(a){var b,c;a!=null&&k.push(a);if(j===0)return b=null,k.length>0&&(b=new Error(function(){var a,b,d;d=[];for(a=0,b=k.length;a<b;a++)c=k[a],d.push(c.message);return d}().join("; "))),typeof d=="function"?d(b):void 0},q=this.channels[b];for(o=0,p=q.length;o<p;o++){n=q[o],d.publishReference!==!0&&typeof c=="object"&&(i=f(c)),g=void 0,a.getArgumentNames(n.callback).length>=3?(g=function(a){return j--,l(a)},e.push(g)):j--;try{m=n.callback.apply(n.context,[i||c,b,g]),(m===!1||m instanceof Error)&&k.push(m)}catch(r){r}l()}}return this.cascadeChannels&&(h=b.split("/")).length>1&&this.publish(h.slice(0,-1).join("/"),c,d),this},a.prototype.emit=a.prototype.publish,a.prototype.installTo=function(a){var b,c;if(typeof a=="object")for(b in this)c=this[b],a[b]=c;return this},a._rm=function(a,b,c,d){var e;return a.channels[b]=function(){var f,g,h,i;h=a.channels[b],i=[];for(f=0,g=h.length;f<g;f++)e=h[f],(c!=null?e.callback!==c:d!=null?e.context!==d:e.context!==a)&&i.push(e);return i}()},a}(),(typeof module!=="undefined"&&module!==null?module.exports:void 0)!=null&&(module.exports=a),b=function(){function a(a,b,c){this.core=a,this.instanceId=b,this.options=c!=null?c:{};if(this.core==null)throw new TypeError("core was not defined");if(b==null)throw new TypeError("no id was specified");if(typeof b!="string")throw new TypeError("id is not a string")}return a}(),(typeof module!=="undefined"&&module!==null?module.exports:void 0)!=null&&(module.exports=b),(typeof module!=="undefined"&&module!==null?module.exports:void 0)!=null&&typeof require=="function"&&(a=require("./Mediator"),b=require("./Sandbox")),c="0.3.8",r={},n={},m={},q=new a,u={},k=function(a){return typeof console!="undefined"&&console!==null?typeof console.error=="function"?console.error(a.message):void 0:void 0},D=function(a){var b;a==null&&(a=8),b="";while(b.length<a)b+=Math.random().toString(36).substr(2);return b.substr(0,a)},t={_always:[]},s=function(a,b){var c;if(typeof a!="function")throw new Error("expect a function as parameter");c={context:this,callback:a};if(typeof b=="string")return t[b]==null&&(t[b]=[]),t[b].push(c);if(b==null)return t._always.push(c)},l=function(a,b,c){var d,e,f,g,h;f={},h=b.options;for(e in h)g=h[e],f[e]=g;d=m[a];if(d)for(e in d)g=d[e],f[e]=g;if(c)for(e in c)g=c[e],f[e]=g;return f},i=function(a,c,d){var e,f,h,i,j,k,m,o,p,s,v,w,x,y,z,A,B;c==null&&(c=a),k=r[a];if(n[c]!=null)return n[c];h=l(c,k,d),s=new b(g,c,h),q.installTo(s);for(f in u){o=u[f];if(o.sandbox==null)continue;p=new o.sandbox(s);for(j in p){if(!G.call(p,j))continue;v=p[j],s[j]=v}}i=new k.creator(s),i.options=h,i.id=c,n[c]=i,A=[c,"_always"];for(w=0,y=A.length;w<y;w++){m=A[w];if(t[m]!=null){B=t[m];for(x=0,z=B.length;x<z;x++)e=B[x],e.callback.apply(e.context)}}return i},d=function(a,b,c){var d;if(typeof a!="string")throw new TypeError("module ID has to be a string");if(typeof b!="function")throw new TypeError("creator has to be a constructor function");if(typeof c!="object")throw new TypeError("option parameter has to be an object");d=new b;if(typeof d!="object")throw new TypeError("creator has to return an object");if(typeof d.init!="function")throw new TypeError("module has to have an init function");if(typeof d.destroy!="function")throw new TypeError("module has to have a destroy function");if(r[a]!=null)throw new TypeError("module "+a+" was already registered");return r[a]={creator:b,options:c,id:a},!0},v=function(a,b,c){c==null&&(c={});try{return d(a,b,c)}catch(e){return k(new Error("could not register module '"+a+"': "+e.message)),!1}},y=function(a,b){var c,d,e,f;if(typeof a!="string")throw new TypeError("instance ID has to be a string");if(typeof b!="object")throw new TypeError("option parameter has to be an object");(e=m[a])==null&&(m[a]={}),f=[];for(c in b)d=b[c],f.push(m[a][c]=d);return f},E=function(a){return r[a]!=null?(delete r[a],!0):!1},F=function(){var a,b;b=[];for(a in r)b.push(E(a));return b},z=function(b,c){var d;c==null&&(c={});try{if(typeof b!="string")throw new Error("module ID has to be a string");if(typeof c!="object")throw new Error("second parameter has to be an object");if(r[b]==null)throw new Error("module does not exist");d=i(b,c.instanceId,c.options);if(d.running===!0)throw new Error("module was already started");return a.getArgumentNames(d.init).length>=2?d.init(d.options,function(a){return typeof c.callback=="function"?c.callback(a):void 0}):(d.init(d.options),typeof c.callback=="function"&&c.callback(null)),d.running=!0,!0}catch(e){return k(e),typeof c.callback=="function"&&c.callback(new Error("could not start module: "+e.message)),!1}},B=function(b,c){var d;return(d=n[b])?(q.unsubscribe(d),a.getArgumentNames(d.destroy).length>=1?d.destroy(function(a){return typeof c=="function"?c(a):void 0}):(d.destroy(),typeof c=="function"&&c(null)),delete n[b],!0):!1},j=function(a,b,c){var d,f,g,h,i,j;f=a.length;if(f===0)return typeof c=="function"&&c(null),!0;g=[],d=function(){return f--,e(f,g,c)};for(i=0,j=a.length;i<j;i++)h=a[i],b(h,d)||g.push("'"+h+"'");return g.length===0},e=function(a,b,c){if(a===0)return b.length>0?typeof c=="function"?c(new Error("errors occoured in the following modules: "+b)):void 0:typeof c=="function"?c(null):void 0},A=function(a,b){var c,d,e,f,g,h,i,k;return a instanceof Array?(g=a,a=b,b=null,i=function(){var a,b,c;c=[];for(a=0,b=g.length;a<b;a++)d=g[a],r[d]!=null&&c.push(d);return c}()):g=i=function(){var a;a=[];for(d in r)a.push(d);return a}(),i.length===(k=g.length)&&k===0?(typeof a=="function"&&a(null),!0):(i.length!==g.length&&(e=function(){var a,b,c;c=[];for(a=0,b=g.length;a<b;a++)d=g[a],H.call(i,d)>=0||c.push("'"+d+"'");return c}(),f=new Error("these modules don't exist: "+e)),h=function(a,b){var c,d,e,f;e={},d=r[a].options;for(c in d){if(!G.call(d,c))continue;f=d[c],f&&(e[c]=f)}return e.callback=function(a){return typeof d.callback=="function"&&d.callback(a),typeof b=="function"?b():void 0},z(a,e)},c=function(b){return typeof a=="function"?a(b||f):void 0},j(i,h,c)&&f==null)},C=function(a){var b;return j(function(){var a;a=[];for(b in n)a.push(b);return a}(),function(a,b){return B(a,b)},a)},h=["VERSION","register","unregister","registerPlugin","start","stop","startAll","stopAll","publish","subscribe","unsubscribe","on","emit","setInstanceOptions","Mediator","Sandbox","unregisterAll","uniqueId","lsModules","lsInstances"],x=["core","instanceId","options","publish","emit","on","subscribe","unsubscribe"],p=function(){var a,b,c;c=[];for(a in r)b=r[a],c.push(a);return c},o=function(){var a,b,c;c=[];for(a in n)b=n[a],c.push(a);return c},w=function(a){var c,d,e,f;try{if(typeof a!="object")throw new Error("plugin has to be an object");if(typeof a.id!="string")throw new Error("plugin has no id");if(typeof a.sandbox=="function"){for(c in new a.sandbox(new b(g,"")))if(H.call(x,c)>=0)throw new Error("plugin uses reserved keyword");e=a.sandbox.prototype;for(c in e)d=e[c],b.prototype[c]=d}if(typeof a.core=="object"){for(c in a.core)if(H.call(h,c)>=0)throw new Error("plugin uses reserved keyword");f=a.core;for(c in f)d=f[c],g[c]=d,typeof exports!="undefined"&&exports!==null&&(exports[c]=d)}return typeof a.onInstantiate=="function"&&s(a.onInstantiate),u[a.id]=a,!0}catch(i){return k(i),!1}},g={VERSION:c,register:v,unregister:E,unregisterAll:F,registerPlugin:w,setInstanceOptions:y,start:z,stop:B,startAll:A,stopAll:C,uniqueId:D,lsInstances:o,lsModules:p,Mediator:a,Sandbox:b,subscribe:function(){return q.subscribe.apply(q,arguments)},on:function(){return q.subscribe.apply(q,arguments)},unsubscribe:function(){return q.unsubscribe.apply(q,arguments)},publish:function(){return q.publish.apply(q,arguments)},emit:function(){return q.publish.apply(q,arguments)}},(typeof module!=="undefined"&&module!==null?module.exports:void 0)!=null&&(module.exports=g),typeof window!="undefined"&&window!==null&&(window.scaleApp=g),(typeof define!=="undefined"&&define!==null?define.amd:void 0)!=null&&define(function(){return g})}).call(this);