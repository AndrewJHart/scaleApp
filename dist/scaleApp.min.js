(function(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j,F,I,q=[].slice,R={}.hasOwnProperty,U=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};a=function(e){var t,n,r;if(e instanceof Array)t=function(){var t,n,i;i=[];for(t=0,n=e.length;t<n;t++)r=e[t],i.push(r);return i}();else{t={};for(n in e)r=e[n],t[n]=r}return t},String.prototype.trim==null&&(String.prototype.trim=function(){return this.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}),d=function(e){var t,n,r,i,s;e==null&&(e=function(){}),n=e.toString().match(/function[^(]*\(([^)]*)\)/);if(n==null||n.length<2)return[];n=n[1],n=n.split(/\s*,\s*/),s=[];for(r=0,i=n.length;r<i;r++)t=n[r],t.trim()!==""&&s.push(t);return s},H=function(e){var t;e==null&&(e=8),t="";while(t.length<e)t+=Math.random().toString(36).substr(2);return t.substr(0,e)},k=function(e,t,n){var r,i,s,o,u,a,f,l,c;e==null&&(e=[]),t==null&&(t=function(){}),i=e.length,u=[];if(i===0)return typeof t=="function"?t(null,u):void 0;s=[],r=function(){var e;i--;if(i===0)return function(){var t,n,r;r=[];for(t=0,n=s.length;t<n;t++)e=s[t],e!=null&&r.push(e);return r}().length>0?t(s,u):t(null,u)},c=[];for(o=f=0,l=e.length;f<l;o=++f)a=e[o],c.push(function(e,t){var i;i=function(){var e,n;return e=arguments[0],n=2<=arguments.length?q.call(arguments,1):[],e!=null?(s[t]=e,u[t]=void 0):u[t]=n.length<2?n[0]:n,r()};try{return e(i)}catch(o){if(n)return i(o)}}(a,o));return c},L=function(e,t){var n,r;return n=-1,e.length===0?t():(r=function(){var i,s;return i=arguments[0],s=2<=arguments.length?q.call(arguments,1):[],i!=null?t(i):++n===e.length?t.apply(null,[null].concat(q.call(s))):e[n].apply(e,q.call(s).concat([r]))},r())},h=function(e,t,n){var r,i;return e==null&&(e=[]),i=function(){var n,i,s;s=[];for(n=0,i=e.length;n<i;n++)r=e[n],s.push(function(e){return function(n){return t(e,n)}}(r));return s}(),F.runSeries(i,n)},F={doForAll:h,runSeries:k,runWaterfall:L,clone:a,getArgumentNames:d,uniqueId:H},(typeof module!=="undefined"&&module!==null?module.exports:void 0)!=null&&(module.exports=F),(typeof module!=="undefined"&&module!==null?module.exports:void 0)!=null&&typeof require=="function"&&(F=require("./Util")),t=function(){function e(e,t){this.cascadeChannels=t!=null?t:!1,this.channels={},e&&this.installTo(e)}return e.prototype.subscribe=function(t,n,r){var i,s,o,u,a,f,l,c,h,p,d;r==null&&(r=this),(h=(f=this.channels)[t])==null&&(f[t]=[]),u=this;if(t instanceof Array){p=[];for(l=0,c=t.length;l<c;l++)i=t[l],p.push(this.subscribe(i,n,r));return p}if(typeof t=="object"){d=[];for(s in t)a=t[s],d.push(this.subscribe(s,a,n));return d}return typeof n!="function"?!1:typeof t!="string"?!1:(o={context:r,callback:n},{attach:function(){return u.channels[t].push(o),this},detach:function(){return e._rm(u,t,o.callback),this}}.attach())},e.prototype.on=e.prototype.subscribe,e.prototype.unsubscribe=function(t,n){var r;switch(typeof t){case"string":typeof n=="function"&&e._rm(this,t,n),typeof n=="undefined"&&e._rm(this,t);break;case"function":for(r in this.channels)e._rm(this,r,t);break;case"undefined":for(r in this.channels)e._rm(this,r);break;case"object":for(r in this.channels)e._rm(this,r,null,t)}return this},e.prototype.publish=function(e,t,n){var r,i,s,o,u;return n==null&&(n={}),typeof t=="function"&&(n=t,t=void 0),typeof e!="string"?!1:(o=this.channels[e]||[],typeof t=="object"&&n.publishReference!==!0&&(i=F.clone(t)),u=function(){var n,r,u;u=[];for(n=0,r=o.length;n<r;n++)s=o[n],u.push(function(n){return function(r){try{return F.getArgumentNames(n.callback).length>=3?n.callback.apply(n.context,[i||t,e,r]):r(null,n.callback.apply(n.context,[i||t,e]))}catch(s){return r(s)}}}(s));return u}(),F.runSeries(u,function(e,t){var r,i;return e&&(r=new Error(function(){var t,n,r;r=[];for(t=0,n=e.length;t<n;t++)i=e[t],i!=null&&r.push(i.message);return r}().join("; "))),typeof n=="function"?n(r):void 0},!0),this.cascadeChannels&&(r=e.split("/")).length>1&&this.publish(r.slice(0,-1).join("/"),t,n),this)},e.prototype.emit=e.prototype.publish,e.prototype.installTo=function(e){var t,n;if(typeof e=="object")for(t in this)n=this[t],e[t]=n;return this},e._rm=function(e,t,n,r){var i;return e.channels[t]=function(){var s,o,u,a;u=e.channels[t],a=[];for(s=0,o=u.length;s<o;s++)i=u[s],(n!=null?i.callback!==n:r!=null?i.context!==r:i.context!==e)&&a.push(i);return a}()},e}(),(typeof module!=="undefined"&&module!==null?module.exports:void 0)!=null&&(module.exports=t),i=function(){function e(e,t,n){this.core=e,this.instanceId=t,this.options=n!=null?n:{};if(this.core==null)throw new TypeError("core was not defined");if(t==null)throw new TypeError("no id was specified");if(typeof t!="string")throw new TypeError("id is not a string")}return e}(),(typeof module!=="undefined"&&module!==null?module.exports:void 0)!=null&&(module.exports=i),s="0.3.9",e="function",r="string",n="object",u=function(e,t,n){if(typeof t!==e)throw new TypeError(""+n+" has to be a "+e)},(typeof module!=="undefined"&&module!==null?module.exports:void 0)!=null&&typeof require===e&&require.amd==null&&(t=require("./Mediator"),i=require("./Sandbox"),F=require("./Util")),E={},g={},m={},w=new t,T={},p=function(e){return typeof console!="undefined"&&console!==null?typeof console.error=="function"?console.error(e.message):void 0:void 0},x={_always:[]},S=function(t,n){var i;u(e,t,"parameter"),i={context:this,callback:t};if(typeof n===r)return x[n]==null&&(x[n]=[]),x[n].push(i);if(n==null)return x._always.push(i)},v=function(e,t,n){var r,i,s,o,u;s={},u=t.options;for(i in u)o=u[i],s[i]=o;r=m[e];if(r)for(i in r)o=r[i],s[i]=o;if(n)for(i in n)o=n[i],s[i]=o;return s},c=function(e,t,n){var r,s,o,u,a,l,c,h,p,d,m,y,b,S,N,C,k;t==null&&(t=e),l=E[e];if(g[t]!=null)return g[t];o=v(t,l,n),d=new i(f,t,o),w.installTo(d);for(s in T){h=T[s];if(h.sandbox==null)continue;p=new h.sandbox(d);for(a in p){if(!R.call(p,a))continue;m=p[a],d[a]=m}}u=new l.creator(d),u.options=o,u.id=t,g[t]=u,C=[t,"_always"];for(y=0,S=C.length;y<S;y++){c=C[y];if(x[c]!=null){k=x[c];for(b=0,N=k.length;b<N;b++)r=k[b],r.callback.apply(r.context)}}return u},o=function(t,i,s){var o;u(r,t,"module ID"),u(e,i,"creator"),u(n,s,"option parameter"),o=new i,u(n,o,"the return value of the creator"),u(e,o.init,"'init' of the module"),u(e,o.destroy,"'destroy' of the module ");if(E[t]!=null)throw new TypeError("module "+t+" was already registered");return E[t]={creator:i,options:s,id:t},!0},N=function(e,t,n){n==null&&(n={});try{return o(e,t,n)}catch(r){return p(new Error("could not register module '"+e+"': "+r.message)),!1}},O=function(e,t){var i,s,o,a;u(r,e,"instance ID"),u(n,t,"option parameter"),(o=m[e])==null&&(m[e]={}),a=[];for(i in t)s=t[i],a.push(m[e][i]=s);return a},B=function(e,t){return t[e]!=null?(delete t[e],!0):!1},j=function(e){var t,n;n=[];for(t in e)n.push(B(t,e));return n},M=function(e,t){var i;t==null&&(t={});try{u(r,e,"module ID"),u(n,t,"second parameter");if(E[e]==null)throw new Error("module doesn't exist");i=c(e,t.instanceId,t.options);if(i.running===!0)throw new Error("module was already started");return F.getArgumentNames(i.init).length>=2?i.init(i.options,function(e){return typeof t.callback=="function"?t.callback(e):void 0}):(i.init(i.options),typeof t.callback=="function"&&t.callback(null)),i.running=!0,!0}catch(s){return p(s),typeof t.callback=="function"&&t.callback(new Error("could not start module: "+s.message)),!1}},D=function(e,t){var n;return(n=g[e])?(w.unsubscribe(n),F.getArgumentNames(n.destroy).length>=1?n.destroy(function(e){return typeof t=="function"?t(e):void 0}):(n.destroy(),typeof t=="function"&&t(null)),delete g[e],!0):!1},_=function(e,t){var n,r,i,s,o,u,a;return e instanceof Array?(s=e,e=t,t=null,u=function(){var e,t,r;r=[];for(e=0,t=s.length;e<t;e++)n=s[e],E[n]!=null&&r.push(n);return r}()):s=u=function(){var e;e=[];for(n in E)e.push(n);return e}(),u.length===(a=s.length)&&a===0?(typeof e=="function"&&e(null),!0):(u.length!==s.length&&(r=function(){var e,t,r;r=[];for(e=0,t=s.length;e<t;e++)n=s[e],U.call(u,n)>=0||r.push("'"+n+"'");return r}(),i=new Error("these modules don't exist: "+r)),o=function(e,t){var n,r,i,s;i={},r=E[e].options;for(n in r){if(!R.call(r,n))continue;s=r[n],s&&(i[n]=s)}return i.callback=function(e){return typeof r.callback=="function"&&r.callback(e),t(e)},M(e,i)},F.doForAll(u,o,function(t){var n,r,s;return(t!=null?t.length:void 0)>0&&(n=new Error("errors occoured in the following modules: "+function(){var e,n,i;i=[];for(r=e=0,n=t.length;e<n;r=++e)s=t[r],s!=null&&i.push("'"+u[r]+"'");return i}())),typeof e=="function"?e(n||i):void 0}),i==null)},P=function(e){var t;return F.doForAll(function(){var e;e=[];for(t in g)e.push(t);return e}(),D,e)},A=["core","instanceId","options","publish","emit","on","subscribe","unsubscribe"],b=function(e){var t,n,r;r=[];for(t in e)n=e[t],r.push(t);return r},C=function(t){var s,o,a,c,h;s=new Error("plugin uses reserved keyword");try{u(n,t,"plugin"),u(r,t.id,"'id' of plugin");if(typeof t.sandbox===e){for(o in new t.sandbox(new i(f,"")))if(U.call(A,o)>=0)throw s;c=t.sandbox.prototype;for(o in c)a=c[o],i.prototype[o]=a}if(typeof t.core===n){for(o in t.core)if(U.call(l,o)>=0)throw s;h=t.core;for(o in h)a=h[o],f[o]=a,typeof exports!="undefined"&&exports!==null&&(exports[o]=a)}return typeof t.onInstantiate===e&&S(t.onInstantiate),T[t.id]=t,!0}catch(d){return p(d),!1}},f={VERSION:s,register:N,unregister:function(e){return B(e,E)},unregisterAll:function(){return j(E)},registerPlugin:C,unregisterPlugin:function(e){return B(e,T)},unregisterAllPlugins:function(){return j(T)},setInstanceOptions:O,start:M,stop:D,startAll:_,stopAll:P,uniqueId:F.uniqueId,lsInstances:function(){return b(g)},lsModules:function(){return b(E)},lsPlugins:function(){return b(T)},util:F,Mediator:t,Sandbox:i,subscribe:function(){return w.subscribe.apply(w,arguments)},on:function(){return w.subscribe.apply(w,arguments)},unsubscribe:function(){return w.unsubscribe.apply(w,arguments)},publish:function(){return w.publish.apply(w,arguments)},emit:function(){return w.publish.apply(w,arguments)}},l=function(){var e;e=[];for(y in f)I=f[y],e.push(y);return e}(),(typeof module!=="undefined"&&module!==null?module.exports:void 0)!=null&&(module.exports=f),(typeof define!=="undefined"&&define!==null?define.amd:void 0)!=null?(typeof define!=="undefined"&&define!==null?define.amd:void 0)!=null&&define(function(){return f}):typeof window!="undefined"&&window!==null&&(window.scaleApp=f)}).call(this);