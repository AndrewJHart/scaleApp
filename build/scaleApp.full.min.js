(function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,$={}.hasOwnProperty,_=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1},ab=function(a,b){return function(){return a.apply(b,arguments)}},bb=function(a,b){function d(){this.constructor=a}for(var c in b)$.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},cb=[].slice;c=function(){function a(a){this.channels={},a&&this.installTo(a)}return a.name="Mediator",a.prototype.subscribe=function(b,c,d){var e,f,g,h,i,j,k,l,m,n;d==null&&(d=this),(j=this.channels)[b]==null&&(j[b]=[]),h=this;if(b instanceof Array){m=[];for(k=0,l=b.length;k<l;k++)e=b[k],m.push(this.subscribe(e,c,d));return m}if(typeof b=="object"){n=[];for(f in b)i=b[f],n.push(this.subscribe(f,i,c));return n}return g={context:d,callback:c},{attach:function(){return h.channels[b].push(g),this},detach:function(){return a._rm(h,b,g.callback),this}}.attach()},a.prototype.unsubscribe=function(b,c){var d;switch(typeof b){case"string":typeof c=="function"&&a._rm(this,b,c),typeof c=="undefined"&&a._rm(this,b);break;case"function":for(d in this.channels)a._rm(this,d,b);break;case"undefined":for(d in this.channels)a._rm(this,d);break;case"object":for(d in this.channels)a._rm(this,d,null,b)}return this},a.prototype.publish=function(a,b,c){var d,e,f,g,h,i,j;if(this.channels[a]!=null){j=this.channels[a];for(h=0,i=j.length;h<i;h++){f=j[h];if(c!==!0&&typeof b=="object"){if(b instanceof Array)d=function(){var a,c,d;d=[];for(a=0,c=b.length;a<c;a++)g=b[a],d.push(g);return d}();else{d={};for(e in b)g=b[e],d[e]=g}try{f.callback.apply(f.context,[d,a])}catch(k){typeof console!="undefined"&&console!==null&&typeof console.error=="function"&&console.error(k)}}else try{f.callback.apply(f.context,[b,a])}catch(k){typeof console!="undefined"&&console!==null&&typeof console.error=="function"&&console.error(k)}}}return this},a.prototype.installTo=function(a){var b,c;if(typeof a=="object")for(b in this)c=this[b],a[b]=c;return this},a._rm=function(a,b,c,d){var e;return a.channels[b]=function(){var f,g,h,i;h=a.channels[b],i=[];for(f=0,g=h.length;f<g;f++)e=h[f],(c!=null?e.callback!==c:d!=null?e.context!==d:e.context!==a)&&i.push(e);return i}()},a}(),typeof exports!="undefined"&&exports!==null&&(exports.Mediator=c),f=function(){function a(a,b,c){this.core=a,this.instanceId=b,this.options=c!=null?c:{};if(this.core==null)throw new Error("core was not defined");if(b==null)throw new Error("no id was specified");if(typeof b!="string")throw new Error("id is not a string")}return a.name="Sandbox",a}(),typeof exports!="undefined"&&exports!==null&&(exports.Sandbox=f),typeof require=="function"&&(c=require("./Mediator").Mediator,f=require("./Sandbox").Sandbox),h="0.3.7",E={},y={},D=new c,I={},r=function(a){return typeof console!="undefined"&&console!==null?typeof console.error=="function"?console.error(a.message):void 0:void 0},U=function(a){var b;a==null&&(a=8),b="";while(b.length<a)b+=Math.random().toString(36).substr(2);return b.substr(0,a)},G={_always:[]},F=function(a,b){var c;if(typeof a!="function")throw new Error("expect a function as parameter");c={context:this,callback:a};if(typeof b=="string")return G[b]==null&&(G[b]=[]),G[b].push(c);if(b==null)return G._always.push(c)},p=function(a,b,c){var d,e,g,h,i,j,k,l,m,o,p,q,r,s,t,u,v,w,x,z;b==null&&(b=a),k=E[a];if(y[b]!=null)return y[b];h={},w=k.options;for(j in w)r=w[j],h[j]=r;if(c)for(j in c)r=c[j],h[j]=r;p=new f(n,b,h),D.installTo(p);for(e in I){m=I[e];if(m.sandbox==null)continue;o=new m.sandbox(p);for(i in o){if(!$.call(o,i))continue;q=o[i],p[i]=q}}g=new k.creator(p),g.options=h,g.id=b,y[b]=g,x=[b,"_always"];for(s=0,u=x.length;s<u;s++){l=x[s];if(G[l]!=null){z=G[l];for(t=0,v=z.length;t<v;t++)d=z[t],d.callback.apply(d.context)}}return g},j=function(a,b,c){var d;if(typeof a!="string")throw new Error("moudule ID has to be a string");if(typeof b!="function")throw new Error("creator has to be a constructor function");if(typeof c!="object")throw new Error("option parameter has to be an object");d=new b;if(typeof d!="object")throw new Error("creator has to return an object");if(typeof d.init!="function")throw new Error("module has to have an init function");if(typeof d.destroy!="function")throw new Error("module has to have a destroy function");if(E[a]!=null)throw new Error("module "+a+" was already registered");return E[a]={creator:b,options:c,id:a},!0},J=function(a,b,c){c==null&&(c={});try{return j(a,b,c)}catch(d){return r(new Error("could not register module '"+a+"': "+d.message)),!1}},V=function(a){return E[a]!=null?(delete E[a],!0):!1},W=function(){var a,b;b=[];for(a in E)b.push(V(a));return b},t=function(a){var b,c,d,e,f;c=a.toString().match(/function\b[^(]*\(([^)]*)\)/)[1],c=c.split(/\s*,\s*/),f=[];for(d=0,e=c.length;d<e;d++)b=c[d],b.trim()!==""&&f.push(b);return f},P=function(a,b){var c;b==null&&(b={});try{if(typeof a!="string")throw new Error("module ID has to be a string");if(typeof b!="object")throw new Error("second parameter has to be an object");if(E[a]==null)throw new Error("module does not exist");c=p(a,b.instanceId,b.options);if(c.running===!0)throw new Error("module was already started");return t(c.init).length>=2?c.init(c.options,function(a){return typeof b.callback=="function"?b.callback(a):void 0}):(c.init(c.options),typeof b.callback=="function"&&b.callback(null)),c.running=!0,!0}catch(d){return r(d),typeof b.callback=="function"&&b.callback(new Error("could not start module: "+d.message)),!1}},R=function(a,b){var c;return(c=y[a])?(D.unsubscribe(c),t(c.destroy).length>=1?c.destroy(function(a){return typeof b=="function"?b(a):void 0}):(c.destroy(),typeof b=="function"&&b(null)),delete y[a],!0):!1},q=function(a,b,c){var d,e,f,g,h,i;e=a.length;if(e===0)return typeof c=="function"&&c(null),!0;f=[],d=function(){return e--,m(e,f,c)};for(h=0,i=a.length;h<i;h++)g=a[h],b(g,d)||f.push("'"+g+"'");return f.length===0},m=function(a,b,c){if(a===0)return b.length>0?typeof c=="function"?c(new Error("errors occoured in the following modules: "+b)):void 0:typeof c=="function"?c(null):void 0},Q=function(a,b){var c,d,e,f,g,h,i,j;return a instanceof Array?(g=a,a=b,b=null,i=function(){var a,b,c;c=[];for(a=0,b=g.length;a<b;a++)d=g[a],E[d]!=null&&c.push(d);return c}()):g=i=function(){var a;a=[];for(d in E)a.push(d);return a}(),i.length===(j=g.length)&&j===0?(typeof a=="function"&&a(null),!0):(i.length!==g.length&&(e=function(){var a,b,c;c=[];for(a=0,b=g.length;a<b;a++)d=g[a],_.call(i,d)>=0||c.push("'"+d+"'");return c}(),f=new Error("these modules don't exist: "+e)),h=function(a,b){var c,d,e,f;e={},d=E[a].options;for(c in d){if(!$.call(d,c))continue;f=d[c],f&&(e[c]=f)}return e.callback=function(a){return typeof d.callback=="function"&&d.callback(a),typeof b=="function"?b():void 0},P(a,e)},c=function(b){return typeof a=="function"?a(b||f):void 0},q(i,h,c)&&f==null)},S=function(a){var b;return q(function(){var a;a=[];for(b in y)a.push(b);return a}(),function(a,b){return R(a,b)},a)},o=["VERSION","register","unregister","registerPlugin","start","stop","startAll","stopAll","publish","subscribe","unsubscribe","Mediator","Sandbox","unregisterAll","uniqueId","lsModules","lsInstances"],L=["core","instanceId","options","publish","subscribe","unsubscribe"],C=function(){var a,b,c;c=[];for(a in E)b=E[a],c.push(a);return c},B=function(){var a,b,c;c=[];for(a in y)b=y[a],c.push(a);return c},K=function(a){var b,c,d,e;try{if(typeof a!="object")throw new Error("plugin has to be an object");if(typeof a.id!="string")throw new Error("plugin has no id");if(typeof a.sandbox=="function"){for(b in new a.sandbox(new f(n,"")))if(_.call(L,b)>=0)throw new Error("plugin uses reserved keyword");d=a.sandbox.prototype;for(b in d)c=d[b],f.prototype[b]=c}if(typeof a.core=="object"){for(b in a.core)if(_.call(o,b)>=0)throw new Error("plugin uses reserved keyword");e=a.core;for(b in e)c=e[b],n[b]=c,typeof exports!="undefined"&&exports!==null&&(exports[b]=c)}return typeof a.onInstantiate=="function"&&F(a.onInstantiate),I[a.id]=a,!0}catch(g){return r(g),!1}},n={VERSION:h,register:J,unregister:V,unregisterAll:W,registerPlugin:K,start:P,stop:R,startAll:Q,stopAll:S,uniqueId:U,lsInstances:B,lsModules:C,Mediator:c,Sandbox:f,subscribe:function(){return D.subscribe.apply(D,arguments)},unsubscribe:function(){return D.unsubscribe.apply(D,arguments)},publish:function(){return D.publish.apply(D,arguments)}};if(typeof exports!="undefined"&&exports!==null&&typeof module!="undefined"&&module!==null)for(z in n)Y=n[z],exports[z]=Y;typeof window!="undefined"&&window!==null&&(window.scaleApp=n),b=function(){function a(a){this.sb=a,this.getContainer=ab(this.getContainer,this)}return a.name="DOMPlugin",a.prototype.getContainer=function(){switch(typeof this.sb.options.container){case"string":return document.getElementById(this.sb.options.container);case"object":return this.sb.options.container;default:return document.getElementById(this.sb.instanceId)}},a}(),H={id:"dom",sandbox:b},window.scaleApp!=null&&window.scaleApp.registerPlugin(H),typeof exports!="undefined"&&exports!==null&&(exports.Plugin=H),M=(typeof window!="undefined"&&window!==null?window.scaleApp:void 0)||(typeof require=="function"?require("../scaleApp"):void 0),d=function(a){function b(a){var c,d;b.__super__.constructor.call(this),this.id=(a!=null?a.id:void 0)||M.uniqueId();for(c in a)d=a[c],this[c]==null&&(this[c]=d)}return bb(b,a),b.name="Model",b.prototype.set=function(a,c,d){var e,f;d==null&&(d=!1);switch(typeof a){case"object":for(e in a)f=a[e],this.set(e,f,!0);d||this.publish(b.CHANGED,function(){var b;b=[];for(e in a)f=a[e],b.push(e);return b}());break;case"string":a!=="set"&&a!=="get"&&this[a]!==c&&(this[a]=c,d||this.publish(b.CHANGED,[a]));break;default:typeof console!="undefined"&&console!==null&&typeof console.error=="function"&&console.error("key is not a string")}return this},b.prototype.change=function(a,c){if(typeof a=="function")return this.subscribe(b.CHANGED,a,c);if(arguments.length===0)return this.publish(b.CHANGED)},b.prototype.notify=function(){return this.change()},b.prototype.get=function(a){return this[a]},b.prototype.toJSON=function(){var a,b,c;a={};for(b in this){if(!$.call(this,b))continue;c=this[b],a[b]=c}return a},b.CHANGED="changed",b}(M.Mediator),i=function(){function a(a){a&&this.setModel(a)}return a.name="View",a.prototype.setModel=function(a){return this.model=a,this.model.change(function(){return this.render()},this)},a.prototype.render=function(){},a}(),a=function(){function a(a,b){this.model=a,this.view=b}return a.name="Controller",a}(),H={id:"mvc",core:{Model:d,View:i,Controller:a}},(typeof window!=="undefined"&&window!==null?window.scaleApp:void 0)!=null&&M.registerPlugin(H),typeof exports!="undefined"&&exports!==null&&(exports.Plugin=H),c=(typeof window!="undefined"&&window!==null?(Z=window.scaleApp)!=null?Z.Mediator:void 0:void 0)||(typeof require=="function"?require("../Mediator").Mediator:void 0),k="en",u=function(){return((typeof navigator!="undefined"&&navigator!==null?navigator.language:void 0)||(typeof navigator!="undefined"&&navigator!==null?navigator.browserLanguage:void 0)||k).split("-")[0]},A=u(),D=new c,l="i18n",x={},T=function(){return D.subscribe.apply(D,[l].concat(cb.call(arguments)))},X=function(){return D.unsubscribe.apply(D,[l].concat(cb.call(arguments)))},v=function(){return A},O=function(a){if(typeof a=="string")return A=a,D.publish(l,A)},N=function(a){return typeof a=="object"?(x=a,!0):!1},w=function(a,b,c){var d,e;return((d=b[c])!=null?d[a]:void 0)||((e=x[c])!=null?e[a]:void 0)},s=function(a,b){return b==null&&(b={}),w(a,b,A)||w(a,b,A.substring(0,2))||w(a,b,k)||a},e=function(){function a(a){this.sb=a}return a.name="SBPlugin",a.prototype.i18n={subscribe:T,unsubscribe:X},a.prototype._=function(a){return s(a,this.sb.options.i18n)},a.prototype.getLanguage=v,a}(),H={id:"i18n",sandbox:e,core:{i18n:{setLanguage:O,getBrowserLanguage:u,getLanguage:v,baseLanguage:k,get:s,subscribe:T,unsubscribe:X,setGlobal:N}}},(typeof window!=="undefined"&&window!==null?window.scaleApp:void 0)!=null&&typeof window!="undefined"&&window!==null&&window.scaleApp.registerPlugin(H),typeof exports!="undefined"&&exports!==null&&(exports.Plugin=H),g=function(){function a(a){}return a.name="UtilPlugin",a.prototype.countObjectKeys=function(a){var b,c;if(typeof a=="object")return function(){var d;d=[];for(b in a)c=a[b],d.push(b);return d}().length},a.prototype.mixin=function(a,b,c){c==null&&(c=!1);switch(""+typeof b+"-"+typeof a){case"function-function":return this.mix(b.prototype,a.prototype,c);case"function-object":return this.mix(b.prototype,a,c);case"object-object":return this.mix(b,a,c);case"object-function":return this.mix(b,a.prototype,c)}},a.prototype.mix=function(a,b,c){var d,e,f,g;if(c===!0){f=[];for(d in a)e=a[d],f.push(b[d]=e);return f}g=[];for(d in a)e=a[d],b.hasOwnProperty(d)||g.push(b[d]=e);return g},a}(),H={id:"util",sandbox:g},M!=null&&M.registerPlugin(H),typeof exports!="undefined"&&exports!==null&&(exports.Plugin=H)}).call(this);