((function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y=Object.prototype.hasOwnProperty,z=Array.prototype.indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1};a=function(){function a(a){this.channels={},a&&this.installTo(a)}return a.prototype.subscribe=function(b,c,d){var e,f,g,h,i,j,k,l,m;d==null&&(d=this),this.channels[b]==null&&(this.channels[b]=[]),h=this;if(b instanceof Array){l=[];for(j=0,k=b.length;j<k;j++)e=b[j],l.push(this.subscribe(e,c,d));return l}if(typeof b=="object"){m=[];for(f in b)i=b[f],m.push(this.subscribe(f,i,c));return m}return g={context:d,callback:c},{attach:function(){return h.channels[b].push(g),this},detach:function(){return a._rm(h,b,g.callback),this}}.attach()},a.prototype.unsubscribe=function(b,c){var d;switch(typeof b){case"string":typeof c=="function"&&a._rm(this,b,c),typeof c=="undefined"&&a._rm(this,b);break;case"function":for(d in this.channels)a._rm(this,d,b);break;case"undefined":for(d in this.channels)a._rm(this,d);break;case"object":for(d in this.channels)a._rm(this,d,null,b)}return this},a.prototype.publish=function(a,b,c){var d,e,f,g,h,i,j;if(this.channels[a]!=null){j=this.channels[a];for(h=0,i=j.length;h<i;h++){f=j[h];if(c!==!0&&typeof b=="object"){if(b instanceof Array)d=function(){var a,c,d;d=[];for(a=0,c=b.length;a<c;a++)g=b[a],d.push(g);return d}();else{d={};for(e in b)g=b[e],d[e]=g}f.callback.apply(f.context,[d,a])}else f.callback.apply(f.context,[b,a])}}return this},a.prototype.installTo=function(a){return typeof a=="object"&&(a.subscribe=this.subscribe,a.unsubscribe=this.unsubscribe,a.publish=this.publish,a.channels=this.channels),this},a._rm=function(a,b,c,d){var e;return a.channels[b]=function(){var f,g,h,i;h=a.channels[b],i=[];for(f=0,g=h.length;f<g;f++)e=h[f],(c!=null?e.callback!==c:d!=null?e.context!==d:e.context!==a)&&i.push(e);return i}()},a}(),typeof exports!="undefined"&&exports!==null&&(exports.Mediator=a),b=function(){function a(a,b,c){this.core=a,this.instanceId=b,this.options=c!=null?c:{};if(this.core==null)throw new Error("core was not defined");if(b==null)throw new Error("no id was specified");if(typeof b!="string")throw new Error("id is not a string")}return a}(),typeof exports!="undefined"&&exports!==null&&(exports.Sandbox=b),typeof require=="function"&&(a=require("./Mediator").Mediator,b=require("./Sandbox").Sandbox),c="0.3.3",k={},i={},j=new a,n={},h=function(a){return typeof console!="undefined"&&console!==null?typeof console.error=="function"?console.error(a.message):void 0:void 0},v=function(a){var b;a==null&&(a=8),b="";while(b.length<a)b+=Math.random().toString(36).substr(2);return b.substr(0,a)},m={_always:[]},l=function(a,b){var c;if(typeof a!="function")throw new Error("expect a function as parameter");c={context:this,callback:a};if(typeof b=="string")return m[b]==null&&(m[b]=[]),m[b].push(c);if(b==null)return m._always.push(c)},g=function(a,c,d){var f,g,h,l,o,p,q,r,s,t,u,v,w,x,z,A,B,C,D,E;c==null&&(c=a),q=k[a];if(i[c]!=null)return i[c];l={},C=q.options;for(p in C)w=C[p],l[p]=w;if(d)for(p in d)w=d[p],l[p]=w;u=new b(e,c,l),j.installTo(u);for(g in n){s=n[g];if(s.sandbox==null)continue;t=new s.sandbox(u);for(o in t){if(!y.call(t,o))continue;v=t[o],u[o]=v}}h=new q.creator(u),h.options=l,h.id=c,i[c]=h,D=[c,"_always"];for(x=0,A=D.length;x<A;x++){r=D[x];if(m[r]!=null){E=m[r];for(z=0,B=E.length;z<B;z++)f=E[z],f.callback.apply(f.context)}}return h},d=function(a,b,c){var d;if(typeof a!="string")throw new Error("moudule ID has to be a string");if(typeof b!="function")throw new Error("creator has to be a constructor function");if(typeof c!="object")throw new Error("option parameter has to be an object");d=new b;if(typeof d!="object")throw new Error("creator has to return an object");if(typeof d.init!="function")throw new Error("module has to have an init function");if(typeof d.destroy!="function")throw new Error("module has to have a destroy function");if(k[a]!=null)throw new Error("module "+a+" was already registered");return k[a]={creator:b,options:c,id:a},!0},o=function(a,b,c){c==null&&(c={});try{return d(a,b,c)}catch(e){return h(new Error("could not register module: "+e.message)),!1}},w=function(a){return k[a]!=null?(delete k[a],!0):!1},x=function(){var a,b;b=[];for(a in k)b.push(w(a));return b},r=function(a,b){var c;b==null&&(b={});try{if(typeof a!="string")throw new Error("module ID has to be a string");if(typeof b!="object")throw new Error("second parameter has to be an object");if(k[a]==null)throw new Error("module does not exist");c=g(a,b.instanceId,b.options);if(c.running===!0)throw new Error("module was already started");return c.init(c.options),c.running=!0,typeof b.callback=="function"&&b.callback(),!0}catch(d){return h(d),!1}},t=function(a){var b;return(b=i[a])?(j.unsubscribe(b),b.destroy(),delete i[a]):!1},s=function(a,b){var c,d,e,f,g,h,i;if(a instanceof Array)e=function(){var b,d,e;e=[];for(b=0,d=a.length;b<d;b++)c=a[b],k[c]&&e.push(c);return e}(),a=b;else switch(typeof a){case"undefined":case"function":e=function(){var a;a=[];for(c in k)a.push(c);return a}()}if((e!=null?e.length:void 0)>=1){f={},i=k[e[0]].options;for(d in i){if(!y.call(i,d))continue;h=i[d],h&&(f[d]=h)}return g=f.callback,e.slice(1).length===0?f.callback=function(){return typeof g=="function"&&g(),typeof a=="function"?a():void 0}:f.callback=function(){return typeof g=="function"&&g(),s(e.slice(1),a)},r(e[0],f)}return!1},u=function(){var a,b;b=[];for(a in i)b.push(t(a));return b},f=["VERSION","register","unregister","registerPlugin","start","stop","startAll","stopAll","publish","subscribe","unsubscribe","Mediator","Sandbox","unregisterAll","uniqueId"],q=["core","instanceId","options","publish","subscribe","unsubscribe"],p=function(a){var c,d,g,i;try{if(typeof a!="object")throw new Error("plugin has to be an object");if(typeof a.id!="string")throw new Error("plugin has no id");if(typeof a.sandbox=="function"){for(c in new a.sandbox(new b(e,"")))if(z.call(q,c)>=0)throw new Error("plugin uses reserved keyword");g=a.sandbox.prototype;for(c in g)d=g[c],b.prototype[c]=d}if(typeof a.core=="object"){for(c in a.core)if(z.call(f,c)>=0)throw new Error("plugin uses reserved keyword");i=a.core;for(c in i)d=i[c],e[c]=d}return typeof a.onInstantiate=="function"&&l(a.onInstantiate),n[a.id]=a,!0}catch(j){return h(j),!1}},e={VERSION:c,register:o,unregister:w,unregisterAll:x,registerPlugin:p,start:r,stop:t,startAll:s,stopAll:u,uniqueId:v,Mediator:a,Sandbox:b},j.installTo(e),typeof exports!="undefined"&&exports!==null&&(exports.scaleApp=e),typeof window!="undefined"&&window!==null&&(window.scaleApp=e)})).call(this);