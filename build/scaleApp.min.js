var scaleApp=function(){return function(){var b={},h={},i={},g={},n={},e=[],l=function(a,d,c,k,o){var s=h[a],t,u=function(){typeof k==="function"&&k(t)};if(s){var q={};$.extend(true,q,s.opt,c);a=new b.sandbox(b,d,q);t=s.creator(a);t.opt=q;for(var v in e)e[v](d,q,a);q.templates?r(d,q.templates,function(){delete q.templates;b.log.debug("templates loaded");u()},function(){delete q.templates;typeof o==="function"&&o(t)}):u()}else b.log.error("could not start module '"+a+"' - module does not exist.","core")},
p=function(a,d,c){if(typeof a!=="string"){b.log.error("could not register module- mouduleId has to be a string","core");return false}if(typeof d!=="function"){b.log.error("could not register module - creator has to be a constructor function","core");return false}a=d();if(typeof a!=="object"||typeof a.init!=="function"||typeof a.destroy!=="function"){b.log.error("could not register module - creator has to return an object with the functions 'init' and 'destroy'","core");return false}if(c){if(typeof c!==
"object"){b.log.error("could not register module - option has to be an object","core");c=false}else c=true;if(!c)return false}return true},f=function(a,d,c){if(typeof a==="string"&&(typeof d==="string"&&!c||typeof d==="object"&&!c||typeof d==="string"&&typeof c==="object"||!d&&!c)){if(typeof d==="object"&&!c){c=d;d=a}if(!d&&!c){d=a;c={}}return{moduleId:a,instanceId:d,opt:c}}b.log.error("could not start module '"+a+"' - illegal arguments.","core")},j=function(a,d,c){var k=f(a,d,c);if(k){b.log.debug("start '"+
k.moduleId+"'","core");l(k.moduleId,k.instanceId,k.opt,function(o){i[k.instanceId]=o;o.init()});return true}return false},m=function(a){var d=i[a];if(d){d.destroy();delete i[a];for(var c in g[a])g[a][c]&&m(g[a][c])}else b.log.error("could not stop instance '"+a+"' - instance does not exist.","core")},r=function(a,d,c,k){b.log.debug("loading templates...");var o=0,s=function(q){o--;typeof k==="function"?k(q):b.log.error("could not load template:"+q,"core");o<1&&typeof c==="function"&&c()},t=function(){b.log.debug("template loading successfull");
o--;b.log.debug(o+" templates left");o<1&&typeof c==="function"&&c()},u;for(u in d){o++;w(a,u,d[u],t,s)}},w=function(a,d,c,k){n[a]||(n[a]={});var o=function(s){n[a][d]=$('<script type="text/x-jquery-tmpl">'+s+"<\/script>").template();typeof k==="function"&&k()};typeof c==="string"&&$.get(c,o)};return b={register:function(a,d,c){if(!p(a,d,c))return false;c||(c={});h[a]={creator:d,opt:c};return true},onInstantiate:function(a){typeof a==="function"?e.push(a):b.log.error("scaleApp.onInstantiate expect a function as parameter",
"core")},start:j,startSubModule:function(a,d,c,k){a=f(a,d,c);if(j(a.moduleId,a.instanceId,a.opt)&&typeof k==="string"){(k=g[k])||(k=[]);k.push(a.instanceId)}},stop:m,startAll:function(){for(var a in h)h[a]&&j(a,a,h[a].opt)},stopAll:function(){for(var a in i)i.hasOwnProperty(a)&&m(a)},publish:function(a,d){for(var c in i)if(i[c].subscriptions){var k=i[c].subscriptions[a];if(k)for(var o in k)typeof k[o]==="function"&&k[o](a,d)}},subscribe:function(a,d,c){b.log.debug("subscribe to '"+d+"'",a);a=i[a];
if(!a.subscriptions)a.subscriptions={};a=a.subscriptions;a[d]||(a[d]=[]);a[d].push(c)},getTemplate:function(a,d){var c=n[a];if(c){if(!d&&$(c).length==1){for(var k in c)break;return c[k]}return c[d]}},getContainer:function(a){var d=i[a].opt;if(d)if(typeof d.container==="string")return $("#"+d.container);return $("#"+a)},getInstance:function(a){return i[a]},log:{debug:function(){},info:function(){},warn:function(){},error:function(){},fatal:function(){}},mixin:function(a,d){if(typeof a==="function"&&
typeof d==="function")for(var c in d.prototype)a.prototype[c]||(a.prototype[c]=d.prototype[c]);else if(typeof a==="object"&&typeof d==="function")for(c in d.prototype)a[c]||(a[c]=d.prototype[c])}}}()}();scaleApp.sandbox=function(b,h){var i=function(e,l){b.publish(e,l)},g={debug:function(e){b.log.debug(e,h)},info:function(e){b.log.info(e,h)},warn:function(e){b.log.warn(e,h)},error:function(e){b.log.error(e,h)},fatal:function(e){b.log.fatal(e,h)}},n=function(e){return b.getTemplate(h,e)};return{subscribe:function(e,l){b.subscribe(h,e,l)},unsubscribe:function(e){b.unsubscribe(h,e)},publish:i,startSubModule:function(e,l,p){b.startSubModule(e,l,p,h)},stopSubModule:function(e){b.stop(e)},getModel:function(e){return b.mvc.getModel(h,
e)},getView:function(e){return b.mvc.getView(h,e)},getController:function(e){return b.mvc.getController(h,e)},addModel:function(e,l){return b.mvc.addModel(h,e,l)},addView:function(e,l){return b.mvc.addView(h,e,l)},addController:function(e,l){return b.mvc.addController(h,e,l)},observable:b.mvc.observable,getTemplate:n,tmpl:function(e,l){return $.tmpl(n(e),l)},getContainer:function(){return b.getContainer(h)},debug:g.debug,info:g.info,warn:g.warn,error:g.error,fatal:g.fatal,mixin:b.mixin,_:function(e){return b.i18n._(h,
e)},hotkeys:function(e,l,p,f){if(typeof l==="string"){f||(f="keypress");$(document).bind(f,e,function(){i(l,p)})}else if(typeof l==="function"){p||(p="keypress");$(document).bind(p,e,l)}}}};scaleApp.log=function(){if(!console){console={};console.log=function(){};console.debug=function(){};console.info=function(){};console.warn=function(){};console.error=function(){};console.fatal=function(){}}var b={DEBUG:0,INFO:1,WARN:2,ERROR:3,FATAL:4},h=function(i,g,n){if(n)if(typeof g==="object"){h(i,n+":");h(i,g);return}else g=n+": "+g;switch(i){case b.DEBUG:0<=b.DEBUG&&console.debug(g);break;case b.INFO:0<=b.INFO&&console.info(g);break;case b.WARN:0<=b.WARN&&console.warn(g);break;case b.ERROR:0<=
b.ERROR&&console.error(g);break;case b.FATAL:0<=b.FATAL&&console.error(g);break;default:console.log(g)}};return{debug:function(i,g){h(b.DEBUG,i,g)},info:function(i,g){h(b.INFO,i,g)},warn:function(i,g){h(b.WARN,i,g)},error:function(i,g){h(b.ERROR,i,g)},fatal:function(i,g){h(b.FATAL,i,g)}}}();scaleApp.i18n=function(b){var h=function(){return(navigator.language||navigator.browserLanguage||"en").split("-")[0]},i=h();return{setLanguage:function(g){if(typeof g==="string"){i=g;b.publish("languageChanged",g);return true}return false},getBrowserLanguage:h,getLanguage:function(){return i},_:function(g,n){var e=b.getInstance(g);if(e.opt)if(e.opt.i18n)return e.opt.i18n[i][n];return""}}}(scaleApp);scaleApp.mvc=function(b){var h=function(){};h.prototype={subscribe:function(f){if(!this._subscribers)this._subscribers=[];this._subscribers.push(f)},unsubscribe:function(f){if(this._subscribers)_this.subscribers=this._subscribers.filter(function(j){if(j!==f)return j})},notify:function(){if(this._subscribers)for(var f in this._subscribers)typeof this._subscribers[f].update==="function"&&this._subscribers[f].update()}};var i={},g={},n={};b.onInstantiate(function(f,j){j.models&&e(i,f,j.models);j.views&&
e(g,f,j.views);j.controllers&&e(n,f,j.controllers)});var e=function(f,j,m){if(typeof m==="object")for(var r in m)m[r]&&l(f,j,r,m[r])},l=function(f,j,m,r){f[j]||(f[j]={});f[j][m]=r},p=function(f,j,m){if(f=f[j]){if(!m&&$(f).length==1){for(var r in f)break;return f[r]}return f[m]}};return{addModel:function(f,j,m){l(i,f,j,m)},addView:function(f,j,m){l(g,f,j,m)},addController:function(f,j,m){l(n,f,j,m)},getModel:function(f,j){return p(i,f,j)},getView:function(f,j){return p(g,f,j)},getController:function(f,
j){return p(n,f,j)},observable:h}}(scaleApp);
