var scaleApp=function(){var b={},h={},i={},f={},n={},e=[],l=function(a,d,c,k,o){var t=h[a],u,v=function(){typeof k==="function"&&k(u)};if(t){var r={};$.extend(true,r,t.opt,c);a=new b.sandbox(b,d,r);u=t.creator(a);u.opt=r;for(var w in e)e[w](d,r,a);r.templates?m(d,r.templates,function(){delete r.templates;b.log.debug("templates loaded");v()},function(){delete r.templates;typeof o==="function"&&o(u)}):v()}else b.log.error("could not start module '"+a+"' - module does not exist.","core")},p=function(a,
d,c){if(typeof a!=="string"){b.log.error("could not register module- mouduleId has to be a string","core");return false}if(typeof d!=="function"){b.log.error("could not register module - creator has to be a constructor function","core");return false}a=d();if(typeof a!=="object"||typeof a.init!=="function"||typeof a.destroy!=="function"){b.log.error("could not register module - creator has to return an object with the functions 'init' and 'destroy'","core");return false}if(c){if(typeof c!=="object"){b.log.error("could not register module - option has to be an object",
"core");c=false}else c=true;if(!c)return false}return true},s=function(a,d,c){if(typeof a==="string"&&(typeof d==="string"&&!c||typeof d==="object"&&!c||typeof d==="string"&&typeof c==="object"||!d&&!c)){if(typeof d==="object"&&!c){c=d;d=a}if(!d&&!c){d=a;c={}}return{moduleId:a,instanceId:d,opt:c}}b.log.error("could not start module '"+a+"' - illegal arguments.","core")},g=function(a,d,c){var k=s(a,d,c);if(k){b.log.debug("start '"+k.moduleId+"'","core");l(k.moduleId,k.instanceId,k.opt,function(o){i[k.instanceId]=
o;o.init()});return true}return false},j=function(a){var d=i[a];if(d){d.destroy();delete i[a];for(var c in f[a])f[a][c]&&j(f[a][c])}else b.log.error("could not stop instance '"+a+"' - instance does not exist.","core")},m=function(a,d,c,k){b.log.debug("loading templates...");var o=0,t=function(r){o--;typeof k==="function"?k(r):b.log.error("could not load template:"+r,"core");o<1&&typeof c==="function"&&c()},u=function(){b.log.debug("template loading successfull");o--;b.log.debug(o+" templates left");
o<1&&typeof c==="function"&&c()},v;for(v in d){o++;q(a,v,d[v],u,t)}},q=function(a,d,c,k){n[a]||(n[a]={});var o=function(t){n[a][d]=$('<script type="text/x-jquery-tmpl">'+t+"<\/script>").template();typeof k==="function"&&k()};typeof c==="string"&&$.get(c,o)};return b={register:function(a,d,c){if(!p(a,d,c))return false;c||(c={});h[a]={creator:d,opt:c};return true},onInstantiate:function(a){typeof a==="function"?e.push(a):b.log.error("scaleApp.onInstantiate expect a function as parameter","core")},start:g,
startSubModule:function(a,d,c,k){a=s(a,d,c);if(g(a.moduleId,a.instanceId,a.opt)&&typeof k==="string"){(k=f[k])||(k=[]);k.push(a.instanceId)}},stop:j,startAll:function(){for(var a in h)h[a]&&g(a,a,h[a].opt)},stopAll:function(){for(var a in i)i.hasOwnProperty(a)&&j(a)},publish:function(a,d){for(var c in i)if(i[c].subscriptions){var k=i[c].subscriptions[a];if(k)for(var o in k)typeof k[o]==="function"&&k[o](d,a)}},subscribe:function(a,d,c){b.log.debug("subscribe to '"+d+"'",a);a=i[a];if(!a.subscriptions)a.subscriptions=
{};a=a.subscriptions;a[d]||(a[d]=[]);a[d].push(c)},getTemplate:function(a,d){var c=n[a];if(c){if(!d&&$(c).length==1){for(var k in c)break;return c[k]}return c[d]}},getContainer:function(a){var d=i[a].opt;if(d)if(typeof d.container==="string")return $("#"+d.container);return $("#"+a)},getInstance:function(a){return i[a]},log:{debug:function(){},info:function(){},warn:function(){},error:function(){},fatal:function(){}},mixin:function(a,d){if(typeof a==="function"&&typeof d==="function")for(var c in d.prototype)a.prototype[c]||
(a.prototype[c]=d.prototype[c]);else if(typeof a==="object"&&typeof d==="function")for(c in d.prototype)a[c]||(a[c]=d.prototype[c])}}}(window);scaleApp.sandbox=function(b,h){var i=function(e,l){b.publish(e,l)},f={debug:function(e){b.log.debug(e,h)},info:function(e){b.log.info(e,h)},warn:function(e){b.log.warn(e,h)},error:function(e){b.log.error(e,h)},fatal:function(e){b.log.fatal(e,h)}},n=function(e){return b.getTemplate(h,e)};return{subscribe:function(e,l){b.subscribe(h,e,l)},unsubscribe:function(e){b.unsubscribe(h,e)},publish:i,startSubModule:function(e,l,p){b.startSubModule(e,l,p,h)},stopSubModule:function(e){b.stop(e)},getModel:function(e){return b.mvc.getModel(h,
e)},getView:function(e){return b.mvc.getView(h,e)},getController:function(e){return b.mvc.getController(h,e)},addModel:function(e,l){return b.mvc.addModel(h,e,l)},addView:function(e,l){return b.mvc.addView(h,e,l)},addController:function(e,l){return b.mvc.addController(h,e,l)},observable:b.mvc.observable,getTemplate:n,tmpl:function(e,l){return $.tmpl(n(e),l)},getContainer:function(){return b.getContainer(h)},debug:f.debug,info:f.info,warn:f.warn,error:f.error,fatal:f.fatal,mixin:b.mixin,_:function(e){return b.i18n._(h,
e)},hotkeys:function(e,l,p,s){if(typeof l==="string"){s||(s="keypress");$(document).bind(s,e,function(){i(l,p)})}else if(typeof l==="function"){p||(p="keypress");$(document).bind(p,e,l)}}}};scaleApp.log=function(){if(!console){console={};console.log=function(){};console.debug=function(){};console.info=function(){};console.warn=function(){};console.error=function(){};console.fatal=function(){}}var b={DEBUG:0,INFO:1,WARN:2,ERROR:3,FATAL:4},h=function(i,f,n){if(n)if(typeof f==="object"){h(i,n+":");h(i,f);return}else f=n+": "+f;switch(i){case b.DEBUG:0<=b.DEBUG&&console.debug(f);break;case b.INFO:0<=b.INFO&&console.info(f);break;case b.WARN:0<=b.WARN&&console.warn(f);break;case b.ERROR:0<=
b.ERROR&&console.error(f);break;case b.FATAL:0<=b.FATAL&&console.error(f);break;default:console.log(f)}};return{debug:function(i,f){h(b.DEBUG,i,f)},info:function(i,f){h(b.INFO,i,f)},warn:function(i,f){h(b.WARN,i,f)},error:function(i,f){h(b.ERROR,i,f)},fatal:function(i,f){h(b.FATAL,i,f)}}}();scaleApp.i18n=function(b){var h=function(){return(navigator.language||navigator.browserLanguage||"en").split("-")[0]},i=h();return{setLanguage:function(f){if(typeof f==="string"){i=f;b.publish("languageChanged",f);return true}return false},getBrowserLanguage:h,getLanguage:function(){return i},_:function(f,n){var e=b.getInstance(f);if(e.opt)if(e.opt.i18n)return e.opt.i18n[i][n];return""}}}(scaleApp);scaleApp.mvc=scaleApp.mvc||function(b,h){var i=function(){};i.prototype={subscribe:function(g){if(!this._subscribers)this._subscribers=[];this._subscribers.push(g)},unsubscribe:function(g){if(this._subscribers)_this.subscribers=this._subscribers.filter(function(j){if(j!==g)return j})},notify:function(){if(this._subscribers)for(var g in this._subscribers)typeof this._subscribers[g].update==="function"&&this._subscribers[g].update()}};var f={},n={},e={};h.onInstantiate(function(g,j){if(j.models){var m=
j.models;if(typeof m==="object")for(var q in m)m[q]&&h.mixin(m[q],i);l(f,g,j.models)}j.views&&l(n,g,j.views);j.controllers&&l(e,g,j.controllers)});var l=function(g,j,m){if(typeof m==="object")for(var q in m)m[q]&&p(g,j,q,m[q])},p=function(g,j,m,q){g[j]||(g[j]={});g[j][m]=q},s=function(g,j,m){if(g=g[j]){if(!m&&$(g).length==1){for(var q in g)break;return g[q]}return g[m]}};return{addModel:function(g,j,m){p(f,g,j,m)},addView:function(g,j,m){p(n,g,j,m)},addController:function(g,j,m){p(e,g,j,m)},getModel:function(g,
j){return s(f,g,j)},getView:function(g,j){return s(n,g,j)},getController:function(g,j){return s(e,g,j)},observable:i}}(window,scaleApp);
