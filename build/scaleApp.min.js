var scaleApp=function(){var g={},e={},b={},i={},j=[],l=function(a,c,f,m,o){var q=e[a],r,s=function(){typeof m==="function"&&m(r)};if(q){var p={};$.extend(true,p,q.opt,f);a=new g.sandbox(c,p);r=q.creator(a);r.opt=p;for(var t in j)j[t](c,p,a);p.templates&&g.template?g.template.loadMultiple(p.templates).done(function(u){g.template.set(c,u);s()}).fail(function(){typeof o==="function"&&o(r)}).then(function(){delete p.templates}):s()}else g.log.error("could not start module '"+a+"' - module does not exist.",
"core")},d=function(a,c,f){if(typeof a!=="string"){g.log.error("could not register module- mouduleId has to be a string","core");return false}if(typeof c!=="function"){g.log.error("could not register module - creator has to be a constructor function","core");return false}a=c();if(typeof a!=="object"||typeof a.init!=="function"||typeof a.destroy!=="function"){g.log.error("could not register module - creator has to return an object with the functions 'init' and 'destroy'","core");return false}if(f){if(typeof f!==
"object"){g.log.error("could not register module - option has to be an object","core");f=false}else f=true;if(!f)return false}return true},k=function(a,c,f){if(typeof a==="string"&&(typeof c==="string"&&!f||typeof c==="object"&&!f||typeof c==="string"&&typeof f==="object"||!c&&!f)){if(typeof c==="object"&&!f){f=c;c=a}if(!c&&!f){c=a;f={}}return{moduleId:a,instanceId:c,opt:f}}g.log.error("could not start module '"+a+"' - illegal arguments.","core")},n=function(a,c,f,m){var o=k(a,c,f);if(o){g.log.debug("start '"+
o.moduleId+"'","core");l(o.moduleId,o.instanceId,o.opt,function(q){b[o.instanceId]=q;q.init();typeof m==="function"&&m()});return true}return false},h=function(a){var c=b[a];if(c){c.destroy();delete b[a];for(var f in i[a])i[a][f]&&h(i[a][f])}else g.log.error("could not stop instance '"+a+"' - instance does not exist.","core")};return g={register:function(a,c,f){if(!d(a,c,f))return false;f||(f={});e[a]={creator:c,opt:f};return true},onInstantiate:function(a){typeof a==="function"?j.push(a):g.log.error("scaleApp.onInstantiate expect a function as parameter",
"core")},start:n,startSubModule:function(a,c,f,m){a=k(a,c,f);if(n(a.moduleId,a.instanceId,a.opt)&&typeof m==="string"){(m=i[m])||(m=[]);m.push(a.instanceId)}},stop:h,startAll:function(a){var c=function(){};if(typeof a==="function"){var f=g.util.countObjectKeys(e);c=function(){f--;f===0&&a()}}for(var m in e)e[m]&&n(m,m,e[m].opt,c)},stopAll:function(){for(var a in b)b.hasOwnProperty(a)&&h(a)},publish:function(a,c){for(var f in b)if(b[f].subscriptions){var m=b[f].subscriptions[a];if(m)for(var o in m)typeof m[o]===
"function"&&m[o](c,a)}},subscribe:function(a,c,f){g.log.debug("subscribe to '"+c+"'",a);a=b[a];if(!a.subscriptions)a.subscriptions={};a=a.subscriptions;a[c]||(a[c]=[]);a[c].push(f)},getContainer:function(a){var c=b[a].opt;if(c)if(typeof c.container==="string")return $("#"+c.container);return $("#"+a)},getInstance:function(a){return b[a]},log:{debug:function(){},info:function(){},warn:function(){},error:function(){},fatal:function(){}}}}(window);scaleApp.log=function(){if(!console){console={};console.log=function(){};console.debug=function(){};console.info=function(){};console.warn=function(){};console.error=function(){};console.fatal=function(){}}var g={DEBUG:0,INFO:1,WARN:2,ERROR:3,FATAL:4},e=function(b,i,j){if(j)if(typeof i==="object"){e(b,j+":");e(b,i);return}else i=j+": "+i;switch(b){case g.DEBUG:0<=g.DEBUG&&console.debug(i);break;case g.INFO:0<=g.INFO&&console.info(i);break;case g.WARN:0<=g.WARN&&console.warn(i);break;case g.ERROR:0<=
g.ERROR&&console.error(i);break;case g.FATAL:0<=g.FATAL&&console.error(i);break;default:console.log(i)}};return{debug:function(b,i){e(g.DEBUG,b,i)},info:function(b,i){e(g.INFO,b,i)},warn:function(b,i){e(g.WARN,b,i)},error:function(b,i){e(g.ERROR,b,i)},fatal:function(b,i){e(g.FATAL,b,i)}}}();scaleApp.i18n=scaleApp.i18n||function(g){var e=function(){return(navigator.language||navigator.browserLanguage||"en").split("-")[0]},b=e();return{setLanguage:function(i){if(typeof i==="string"){b=i;g.publish("languageChanged",i);return true}return false},getBrowserLanguage:e,getLanguage:function(){return b},_:function(i,j){var l=g.getInstance(i);if(l.opt)if(l.opt.i18n)return l.opt.i18n[b][j];return""}}}(scaleApp);scaleApp.util=scaleApp.util||function(){return{mixin:function(g,e){if(typeof g==="function"&&typeof e==="function")for(var b in e.prototype)g.prototype[b]||(g.prototype[b]=e.prototype[b]);else if(typeof g==="object"&&typeof e==="function")for(var i in e.prototype)g[i]||(g[i]=e.prototype[i])},countObjectKeys:function(g){var e=0,b;for(b in g)e++;return e}}}(window);scaleApp.template=scaleApp.template||function(g,e){var b={},i=function(j){var l=$.Deferred();typeof j==="string"?$.get(j).done(function(d){l.resolve($('<script type="text/x-jquery-tmpl">'+d+"<\/script>").template())}).fail(function(){l.reject("Could not load the template")}):l.reject("function argument has to be a string");return l.promise()};return{load:i,loadMultiple:function(j){var l=$.Deferred(),d=[],k={},n=function(a){return function(c){k[a]=c}},h;for(h in j)d.push(i(j[h]).done(new n(h)));$.when.apply(null,
d).done(function(){l.resolve(k)});return l.promise()},get:function(j,l){var d=b[j];if(d){if(!l&&$(d).length==1){for(var k in d)break;return d[k]}return d[l]}},add:function(j,l,d){if(typeof j==="string"&&typeof l==="string"&&typeof d==="function"){b[j]||(b[j]={});b[j][l]=d}else e.log.error("could not add template: invalid parameters","template")},set:function(j,l){if(typeof j==="string"&&typeof l==="object")b[j]=l;else e.log.error("could not set templates: invalid parameters","template")}}}(window,
scaleApp);scaleApp.mvc=scaleApp.mvc||function(g,e){var b=function(){};b.prototype={subscribe:function(h){if(!this._subscribers)this._subscribers=[];this._subscribers.push(h)},unsubscribe:function(h){if(this._subscribers)_this.subscribers=this._subscribers.filter(function(a){if(a!==h)return a})},notify:function(){if(this._subscribers)for(var h in this._subscribers)typeof this._subscribers[h].update==="function"&&this._subscribers[h].update()}};var i={},j={},l={};e.onInstantiate(function(h,a){if(a.models){var c=
a.models;if(typeof c==="object")for(var f in c)c[f]&&e.util.mixin(c[f],b);d(i,h,a.models)}a.views&&d(j,h,a.views);a.controllers&&d(l,h,a.controllers)});var d=function(h,a,c){if(typeof c==="object")for(var f in c)c[f]&&k(h,a,f,c[f])},k=function(h,a,c,f){h[a]||(h[a]={});h[a][c]=f},n=function(h,a,c){if(h=h[a]){if(!c&&$(h).length==1){for(var f in h)break;return h[f]}return h[c]}};return{addModel:function(h,a,c){k(i,h,a,c)},addView:function(h,a,c){k(j,h,a,c)},addController:function(h,a,c){k(l,h,a,c)},
getModel:function(h,a){return n(i,h,a)},getView:function(h,a){return n(j,h,a)},getController:function(h,a){return n(l,h,a)},observable:b}}(window,scaleApp);scaleApp.sandbox=scaleApp.sandbox||function(g,e){return function(b){var i=function(d,k){e.publish(d,k)},j={debug:function(d){e.log.debug(d,b)},info:function(d){e.log.info(d,b)},warn:function(d){e.log.warn(d,b)},error:function(d){e.log.error(d,b)},fatal:function(d){e.log.fatal(d,b)}},l=function(d){return e.template.get(b,d)};return{subscribe:function(d,k){e.subscribe(b,d,k)},unsubscribe:function(d){e.unsubscribe(b,d)},publish:i,startSubModule:function(d,k,n){e.startSubModule(d,k,n,b)},stopSubModule:function(d){e.stop(d)},
getModel:function(d){return e.mvc.getModel(b,d)},getView:function(d){return e.mvc.getView(b,d)},getController:function(d){return e.mvc.getController(b,d)},addModel:function(d,k){return e.mvc.addModel(b,d,k)},addView:function(d,k){return e.mvc.addView(b,d,k)},addController:function(d,k){return e.mvc.addController(b,d,k)},observable:e.mvc.observable,getTemplate:l,tmpl:function(d,k){if(typeof d==="string")return $.tmpl(l(d),k);else if(typeof d==="function")return $.tmpl(d,k);else j.error("type of 'id' is not valid",
"sandbox of "+b)},getContainer:function(){return e.getContainer(b)},debug:j.debug,info:j.info,warn:j.warn,error:j.error,fatal:j.fatal,mixin:e.util.mixin,count:e.util.countObjectKeys,_:function(d){return e.i18n._(b,d)},hotkeys:function(d,k,n,h){if(typeof k==="string"){h||(h="keypress");$(document).bind(h,d,function(){i(k,n)})}else if(typeof k==="function"){n||(n="keypress");$(document).bind(n,d,k)}}}}}(window,scaleApp);
