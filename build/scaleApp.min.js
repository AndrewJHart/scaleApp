function k(){return function(){}}
window.scaleApp=function(){function g(j){var a=h[j];if(a)a.destroy(),delete h[j],$.each(m[j],function(j,a){a&&g(a)});else return i.log.error("could not stop instance '"+j+"' - instance does not exist.","core"),!1}function d(j,c,f,b){var d=e(j,c,f);if(d)return i.log.debug("start '"+d.moduleId+"'","core"),a(d.moduleId,d.instanceId,d.opt,function(j){h[d.instanceId]=j;j.init();typeof b==="function"&&b()}),!0;return!1}function c(j,a,b,c){return typeof j==="string"&&(typeof a==="string"&&!b||typeof a===
"object"&&!b||typeof a==="string"&&typeof b==="object"||!a&&!b)||$.isArray(j)&&!a&&!b?d(j,a,b,c):(i.log.error("could not start module '"+j+"' - illegal arguments.","core"),!1)}function e(j,a,b){typeof a==="object"&&!b&&(b=a,a=j);!a&&!b&&(a=j,b={});return{moduleId:j,instanceId:a,opt:b}}function f(a,d,c){if(typeof a!=="string")return i.log.error("could not register module- mouduleId has to be a string","core"),!1;if(typeof d!=="function")return i.log.error("could not register module - creator has to be a constructor function",
"core"),!1;a=d();if(typeof a!=="object"||typeof a.init!=="function"||typeof a.destroy!=="function")return i.log.error("could not register module - creator has to return an object with the functions 'init' and 'destroy'","core"),!1;if(c&&!b(c))return!1;return!0}function b(a){if(typeof a!=="object")return i.log.error("could not register module - option has to be an object","core"),!1;if(a.views&&typeof a.views!=="object")return!1;if(a.models&&typeof a.models!=="object")return!1;if(a.templates&&typeof a.templates!==
"object")return!1;return!0}function a(a,b,d,c){function f(){typeof c==="function"&&c(m)}var e=l[a],m;if(e){var h={};$.extend(!0,h,e.opt,d);var g=new i.sandbox(b,h);m=e.creator(g);m.opt=h;$.each(n,function(a,j){j(b,h,g)});h.templates&&i.template?i.template.loadMultiple(h.templates).done(function(a){i.template.set(b,a);f()}).fail(k()).then(function(){delete h.templates}):f()}else i.log.error("could not start module '"+a+"' - module does not exist.","core")}var i=this,l={},h={},m={},n=[];return i={register:function(a,
b,d){if(!f(a,b,d))return!1;d||(d={});l[a]={creator:b,opt:d};return!0},onInstantiate:function(a){typeof a==="function"?n.push(a):i.log.error("onInstantiate expect a function as parameter","core")},start:c,startSubModule:function(a,b,d,f){a=e(a,b,d);c(a.moduleId,a.instanceId,a.opt)&&typeof f==="string"&&((f=m[f])||(f=[]),f.push(a.instanceId))},stop:g,startAll:function(a,b){function d(){}if(typeof a==="function")var f=0,f=$.isArray(b)?b.length:i.util.countObjectKeys(l),d=function(){f--;f===0&&a()};$.isArray(b)?
$.each(b,function(a,b){typeof b==="string"?c(b,b,l[b].opt,d):typeof b==="object"?b.j&&b.k?c(b.j,b.m,b.k,d):i.log.error("could not start module from array - invalid parameters","core"):i.log.error("could not start module from array","core")}):$.each(l,function(a,b){b&&c(a,a,b.opt,d)})},stopAll:function(){$.each(h,function(a){g(a)})},publish:function(a,b,d){$.each(h,function(f,c){if(c.subscriptions){var e=c.subscriptions[a];e&&$.each(e,function(f,c){if(typeof c==="function")if(typeof b==="object"&&
d!==!0){var e={};$.extend(!0,e,b);c(e,a)}else c(b,a)})}})},subscribe:function(a,b,d){i.log.debug("subscribe to '"+b+"'",a);a=h[a];a.subscriptions||(a.subscriptions={});a=a.subscriptions;a[b]||(a[b]=[]);a[b].push(d)},getContainer:function(a){var b=h[a].opt;if(b&&typeof b.container==="string")return $("#"+b.container);return $("#"+a)},getInstance:function(a){return h[a]},log:{debug:k(),info:k(),warn:k(),error:k(),fatal:k()}}}(window);scaleApp.log=function(g){function d(f,b,a){if(a)if(typeof b==="object"){d(f,a+":");d(f,b);return}else b=a+": "+b;switch(f){case e.d:c<=e.d&&console.debug(b);break;case e.c:c<=e.c&&console.info(b);break;case e.g:c<=e.g&&console.warn(b);break;case e.f:c<=e.f&&console.error(b);break;case e.e:c<=e.e&&console.error(b);break;default:console.log(b)}}g.console||(g.console={log:k(),debug:k(),info:k(),warn:k(),error:k(),fatal:k()});var c=0,e={d:0,c:1,g:2,f:3,e:4};return{debug:function(c,b){d(e.d,c,b)},info:function(c,
b){d(e.c,c,b)},warn:function(c,b){d(e.g,c,b)},error:function(c,b){d(e.f,c,b)},fatal:function(c,b){d(e.e,c,b)},setLogLevel:function(d){if(typeof d==="string")switch(d.toLowerCase()){case "debug":c=e.d;break;case "info":c=e.c;break;case "warn":c=e.g;break;case "error":c=e.f;break;case "fatal":c=e.e;break;default:c=e.c}else typeof d==="number"&&(c=d>=e.d&&d<=e.e?d:e.c)},getLogLevel:function(){return c}}}(window);scaleApp.i18n=function(g,d){function c(){return(navigator.language||navigator.l||"en").split("-")[0]}var e=c();return{setLanguage:function(c){if(typeof c==="string")return e=c,d.publish("languageChanged",c),!0;return!1},getBrowserLanguage:c,getLanguage:function(){return e},_:function(c,b){var a=d.getInstance(c);if(a.opt&&a.opt.i18n)return a.opt.i18n[e][b]||b;return b}}}(window,window.scaleApp);scaleApp.util=scaleApp.util||{mixin:function(g,d){function c(d,c){var b={};$.extend(b,d,c);$.extend(c,b)}switch(typeof d+"-"+typeof g){case "function-function":c(d.prototype,g.prototype);break;case "function-object":c(d.prototype,g);break;case "object-object":c(d,g);break;case "object-function":c(d,g.prototype)}},countObjectKeys:function(g){var d=0;if(typeof g==="object")for(var c in g)d++;return d}};scaleApp.template=scaleApp.template||function(g,d){function c(c){var b=$.Deferred();typeof c==="string"?$.get(c).done(function(a){b.resolve($('<script type="text/x-jquery-tmpl">'+a+"<\/script>").template())}).fail(function(){b.reject("Could not load the template")}):b.reject("function argument has to be a string");return b.promise()}var e={};return{load:c,loadMultiple:function(d){function b(a){return function(b){g[a]=b}}var a=$.Deferred(),e=[],g={},h;for(h in d)e.push(c(d[h]).done(new b(h)));$.when.apply(null,
e).done(function(){a.resolve(g)});return a.promise()},get:function(c,b){var a=e[c];if(a){if(!b&&$(a).length==1){for(var d in a)break;return a[d]}return a[b]}},add:function(c,b,a){typeof c==="string"&&typeof b==="string"&&typeof a==="function"?(e[c]||(e[c]={}),e[c][b]=a):d.log.error("could not add template: invalid parameters","template")},set:function(c,b){typeof c==="string"&&typeof b==="object"?e[c]=b:d.log.error("could not set templates: invalid parameters","template")}}}(window,window.scaleApp);scaleApp.a=scaleApp.a||function(g,d){function c(a,b,c){if(a=a[b]){if(!c&&d.util.countObjectKeys(a)==1){for(var e in a)break;return a[e]}return a[c]}}function e(a,b,c,d){a[b]||(a[b]={});a[b][c]=d}function f(a,b,c){typeof c==="object"&&$.each(c,function(c,d){d&&e(a,b,c,d)})}function b(b){typeof b==="object"&&$.each(b,function(b,c){c&&d.util.mixin(c,a)})}function a(){}a.prototype={subscribe:function(a){if(!this.b)this.b=[];this.b.push(a)},unsubscribe:function(a){if(this.b)this.b=this.b.filter(function(b){if(b!==
a)return b})},notify:function(){this.b&&$.each(this.b,function(a,b){typeof b.update==="function"&&b.update()})}};var i={},l={},h={};d.onInstantiate(function(a,c){c.models&&(b(c.models),f(i,a,c.models));c.views&&f(l,a,c.views);c.controllers&&f(h,a,c.controllers)});return{addModel:function(a,b,c){e(i,a,b,c)},addView:function(a,b,c){e(l,a,b,c)},addController:function(a,b,c){e(h,a,b,c)},getModel:function(a,b){return c(i,a,b)},getView:function(a,b){return c(l,a,b)},getController:function(a,b){return c(h,
a,b)},observable:a}}(window,window.scaleApp);window.scaleApp.sandbox=window.scaleApp.sandbox||function(g,d){return function(c){function e(a){return d.template.get(c,a)}function f(a,b){d.publish(a,b)}var b={h:function(a){d.log.debug(a,c)},info:function(a){d.log.info(a,c)},warn:function(a){d.log.warn(a,c)},error:function(a){d.log.error(a,c)},i:function(a){d.log.fatal(a,c)}};return{subscribe:function(a,b){d.subscribe(c,a,b)},unsubscribe:function(a){d.unsubscribe(c,a)},publish:f,startSubModule:function(a,b,e){d.startSubModule(a,b,e,c)},stopSubModule:function(a){d.stop(a)},
getModel:function(a){return d.a.getModel(c,a)},getView:function(a){return d.a.getView(c,a)},getController:function(a){return d.a.getController(c,a)},addModel:function(a,b){return d.a.addModel(c,a,b)},addView:function(a,b){return d.a.addView(c,a,b)},addController:function(a,b){return d.a.addController(c,a,b)},observable:d.a.observable,getTemplate:e,tmpl:function(a,d){if(typeof a==="string")return $.tmpl(e(a),d);else if(typeof a==="function")return $.tmpl(a,d);else b.error("type of 'id' is not valid",
"sandbox of "+c)},getContainer:function(){return d.getContainer(c)},debug:b.h,info:b.info,warn:b.warn,error:b.error,fatal:b.i,mixin:d.util.mixin,count:d.util.countObjectKeys,_:function(a){return d.i18n._(c,a)},getLanguage:d.i18n.getLanguage,hotkeys:function(a,b,c,d){typeof b==="string"?(d||(d="keypress"),$(document).bind(d,a,function(){f(b,c)})):typeof b==="function"&&(c||(c="keypress"),$(document).bind(c,a,b))}}}}(window,window.scaleApp);
