var scaleApp=function(){var h={},f={},d={},i={},n={},p=[],e=function(a,c,b,k,o){var t=f[a],u,v=function(){typeof k==="function"&&k(u)};if(t){var s={};$.extend(true,s,t.opt,b);a=new h.sandbox(c,s);u=t.creator(a);u.opt=s;for(var w in p)p[w](c,s,a);s.templates?r(c,s.templates,function(){delete s.templates;h.log.debug("templates loaded");v()},function(){delete s.templates;typeof o==="function"&&o(u)}):v()}else h.log.error("could not start module '"+a+"' - module does not exist.","core")},l=function(a,
c,b){if(typeof a!=="string"){h.log.error("could not register module- mouduleId has to be a string","core");return false}if(typeof c!=="function"){h.log.error("could not register module - creator has to be a constructor function","core");return false}a=c();if(typeof a!=="object"||typeof a.init!=="function"||typeof a.destroy!=="function"){h.log.error("could not register module - creator has to return an object with the functions 'init' and 'destroy'","core");return false}if(b){if(typeof b!=="object"){h.log.error("could not register module - option has to be an object",
"core");b=false}else b=true;if(!b)return false}return true},q=function(a,c,b){if(typeof a==="string"&&(typeof c==="string"&&!b||typeof c==="object"&&!b||typeof c==="string"&&typeof b==="object"||!c&&!b)){if(typeof c==="object"&&!b){b=c;c=a}if(!c&&!b){c=a;b={}}return{moduleId:a,instanceId:c,opt:b}}h.log.error("could not start module '"+a+"' - illegal arguments.","core")},g=function(a,c,b,k){var o=q(a,c,b);if(o){h.log.debug("start '"+o.moduleId+"'","core");e(o.moduleId,o.instanceId,o.opt,function(t){d[o.instanceId]=
t;t.init();typeof k==="function"&&k()});return true}return false},j=function(a){var c=d[a];if(c){c.destroy();delete d[a];for(var b in i[a])i[a][b]&&j(i[a][b])}else h.log.error("could not stop instance '"+a+"' - instance does not exist.","core")},m=function(a){var c=0,b;for(b in a)c++;return c},r=function(a,c,b,k){h.log.debug("loading templates...");var o=0,t=function(s){o--;typeof k==="function"?k(s):h.log.error("could not load template:"+s,"core");o<1&&typeof b==="function"&&b()},u=function(){h.log.debug("template loading successfull");
o--;h.log.debug(o+" templates left");o<1&&typeof b==="function"&&b()},v;for(v in c){o++;x(a,v,c[v],u,t)}},x=function(a,c,b,k){n[a]||(n[a]={});var o=function(t){n[a][c]=$('<script type="text/x-jquery-tmpl">'+t+"<\/script>").template();typeof k==="function"&&k()};typeof b==="string"&&$.get(b,o)};return h={register:function(a,c,b){if(!l(a,c,b))return false;b||(b={});f[a]={creator:c,opt:b};return true},onInstantiate:function(a){typeof a==="function"?p.push(a):h.log.error("scaleApp.onInstantiate expect a function as parameter",
"core")},start:g,startSubModule:function(a,c,b,k){a=q(a,c,b);if(g(a.moduleId,a.instanceId,a.opt)&&typeof k==="string"){(k=i[k])||(k=[]);k.push(a.instanceId)}},stop:j,startAll:function(a){var c=function(){};if(typeof a==="function"){var b=m(f);c=function(){b--;b===0&&a()}}for(var k in f)f[k]&&g(k,k,f[k].opt,c)},stopAll:function(){for(var a in d)d.hasOwnProperty(a)&&j(a)},publish:function(a,c){for(var b in d)if(d[b].subscriptions){var k=d[b].subscriptions[a];if(k)for(var o in k)typeof k[o]==="function"&&
k[o](c,a)}},subscribe:function(a,c,b){h.log.debug("subscribe to '"+c+"'",a);a=d[a];if(!a.subscriptions)a.subscriptions={};a=a.subscriptions;a[c]||(a[c]=[]);a[c].push(b)},getTemplate:function(a,c){var b=n[a];if(b){if(!c&&$(b).length==1){for(var k in b)break;return b[k]}return b[c]}},getContainer:function(a){var c=d[a].opt;if(c)if(typeof c.container==="string")return $("#"+c.container);return $("#"+a)},getInstance:function(a){return d[a]},log:{debug:function(){},info:function(){},warn:function(){},
error:function(){},fatal:function(){}},util:{mixin:function(a,c){if(typeof a==="function"&&typeof c==="function")for(var b in c.prototype)a.prototype[b]||(a.prototype[b]=c.prototype[b]);else if(typeof a==="object"&&typeof c==="function")for(b in c.prototype)a[b]||(a[b]=c.prototype[b])},countObjectKeys:m}}}(window);scaleApp.sandbox=scaleApp.sandbox||function(h,f){return function(d){var i=function(e,l){f.publish(e,l)},n={debug:function(e){f.log.debug(e,d)},info:function(e){f.log.info(e,d)},warn:function(e){f.log.warn(e,d)},error:function(e){f.log.error(e,d)},fatal:function(e){f.log.fatal(e,d)}},p=function(e){return f.getTemplate(d,e)};return{subscribe:function(e,l){f.subscribe(d,e,l)},unsubscribe:function(e){f.unsubscribe(d,e)},publish:i,startSubModule:function(e,l,q){f.startSubModule(e,l,q,d)},stopSubModule:function(e){f.stop(e)},
getModel:function(e){return f.mvc.getModel(d,e)},getView:function(e){return f.mvc.getView(d,e)},getController:function(e){return f.mvc.getController(d,e)},addModel:function(e,l){return f.mvc.addModel(d,e,l)},addView:function(e,l){return f.mvc.addView(d,e,l)},addController:function(e,l){return f.mvc.addController(d,e,l)},observable:f.mvc.observable,getTemplate:p,tmpl:function(e,l){if(typeof e==="string")return $.tmpl(p(e),l);else if(typeof e==="function")return $.tmpl(e,l);else n.error("type of 'id' is not valid",
"sandbox of "+d)},getContainer:function(){return f.getContainer(d)},debug:n.debug,info:n.info,warn:n.warn,error:n.error,fatal:n.fatal,mixin:f.util.mixin,count:f.util.countObjectKeys,_:function(e){return f.i18n._(d,e)},hotkeys:function(e,l,q,g){if(typeof l==="string"){g||(g="keypress");$(document).bind(g,e,function(){i(l,q)})}else if(typeof l==="function"){q||(q="keypress");$(document).bind(q,e,l)}}}}}(window,scaleApp);scaleApp.log=function(){if(!console){console={};console.log=function(){};console.debug=function(){};console.info=function(){};console.warn=function(){};console.error=function(){};console.fatal=function(){}}var h={DEBUG:0,INFO:1,WARN:2,ERROR:3,FATAL:4},f=function(d,i,n){if(n)if(typeof i==="object"){f(d,n+":");f(d,i);return}else i=n+": "+i;switch(d){case h.DEBUG:0<=h.DEBUG&&console.debug(i);break;case h.INFO:0<=h.INFO&&console.info(i);break;case h.WARN:0<=h.WARN&&console.warn(i);break;case h.ERROR:0<=
h.ERROR&&console.error(i);break;case h.FATAL:0<=h.FATAL&&console.error(i);break;default:console.log(i)}};return{debug:function(d,i){f(h.DEBUG,d,i)},info:function(d,i){f(h.INFO,d,i)},warn:function(d,i){f(h.WARN,d,i)},error:function(d,i){f(h.ERROR,d,i)},fatal:function(d,i){f(h.FATAL,d,i)}}}();scaleApp.i18n=scaleApp.i18n||function(h){var f=function(){return(navigator.language||navigator.browserLanguage||"en").split("-")[0]},d=f();return{setLanguage:function(i){if(typeof i==="string"){d=i;h.publish("languageChanged",i);return true}return false},getBrowserLanguage:f,getLanguage:function(){return d},_:function(i,n){var p=h.getInstance(i);if(p.opt)if(p.opt.i18n)return p.opt.i18n[d][n];return""}}}(scaleApp);scaleApp.mvc=scaleApp.mvc||function(h,f){var d=function(){};d.prototype={subscribe:function(g){if(!this._subscribers)this._subscribers=[];this._subscribers.push(g)},unsubscribe:function(g){if(this._subscribers)_this.subscribers=this._subscribers.filter(function(j){if(j!==g)return j})},notify:function(){if(this._subscribers)for(var g in this._subscribers)typeof this._subscribers[g].update==="function"&&this._subscribers[g].update()}};var i={},n={},p={};f.onInstantiate(function(g,j){if(j.models){var m=
j.models;if(typeof m==="object")for(var r in m)m[r]&&f.util.mixin(m[r],d);e(i,g,j.models)}j.views&&e(n,g,j.views);j.controllers&&e(p,g,j.controllers)});var e=function(g,j,m){if(typeof m==="object")for(var r in m)m[r]&&l(g,j,r,m[r])},l=function(g,j,m,r){g[j]||(g[j]={});g[j][m]=r},q=function(g,j,m){if(g=g[j]){if(!m&&$(g).length==1){for(var r in g)break;return g[r]}return g[m]}};return{addModel:function(g,j,m){l(i,g,j,m)},addView:function(g,j,m){l(n,g,j,m)},addController:function(g,j,m){l(p,g,j,m)},
getModel:function(g,j){return q(i,g,j)},getView:function(g,j){return q(n,g,j)},getController:function(g,j){return q(p,g,j)},observable:d}}(window,scaleApp);
