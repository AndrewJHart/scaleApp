(function(k,b){function e(d){var i=m[d];if(i)i.destroy(),delete m[d],$.each(u[d],function(d,i){i&&e(i)});else return h("could not stop instance '"+d+"' - instance does not exist.",b),!1}function f(d,i,c,g){return typeof d==="string"&&(typeof i==="string"&&!c||typeof i==="object"&&!c||typeof i==="string"&&typeof c==="object"||!i&&!c)||$.isArray(d)&&!i&&!c?a(d,i,c,g):(h("could not start module '"+d+"' - illegal arguments.",b),!1)}function a(d,i,a,h){var g=c(d,i,a);if(g)return o("start '"+g.moduleId+
"'",b,"debug"),p(g.moduleId,g.instanceId,g.opt,function(d){m[g.instanceId]=d;d.init(d.opt);typeof h==="function"&&h()}),!0;return!1}function c(d,i,a){typeof i==="object"&&!a&&(a=i,i=d);!i&&!a&&(i=d,a={});return{moduleId:d,instanceId:i,opt:a}}function q(d,i,a){if(typeof d!=="string")return h("could not register module- mouduleId has to be a string",b),!1;if(typeof i!=="function")return h("could not register module - creator has to be a constructor function",b),!1;d=i();if(typeof d!=="object"||typeof d.init!==
"function"||typeof d.destroy!=="function")return h("could not register module - creator has to return an object with the functions 'init' and 'destroy'",b),!1;if(a&&!j(a))return!1;return!0}function j(d){if(typeof d!=="object")return h("could not register module - option has to be an object",b),!1;if(d.views&&typeof d.views!=="object")return!1;if(d.models&&typeof d.models!=="object")return!1;return!0}function r(d,i,a,b){function c(d){$.each(d,function(d,c){g.push(c(i,a,b))})}var h=$.Deferred(),g=[];
c(n._always);n[d]&&c(n[d]);$.when.apply(null,g).done(function(){h.resolve()});return h.promise()}function p(d,i,a,c){var h=s[d],g;if(h){var e={};$.extend(!0,e,h.opt,a);var f=new l.sandbox(i,e);$.each(t,function(d,a){var b=new a(f,i);$.extend(!0,f,b)});g=h.creator(f);g.opt=e;r(d,i,e,f).done(function(){typeof c==="function"?c(g):o(" callback function is not a function",b,"warn")}).fail(function(){})}else(void 0)("could not start module '"+d+"' - module does not exist.",b)}function g(d,a){typeof d===
"function"?a&&typeof a==="string"?(n[a]||(n[a]=[]),n[a].push(d)):n._always.push(d):h("onInstantiate expect a function as parameter",b)}function h(d,a){o(d,a,"error")}function o(d,a,b){if(l.log&&typeof l.log[b]==="function")l.log[b](d,a)}var l=this,s={},m={},u={},t={},n={_always:[]},l={register:function(d,a,b){if(!q(d,a,b))return!1;b||(b={});s[d]={creator:a,opt:b};return!0},onInstantiate:g,registerPlugin:function(d,a){typeof d==="string"&&typeof a=="object"?(typeof a.sandbox==="function"&&(t[d]=t[d]||
a.sandbox),(typeof a.core==="function"||typeof a.core==="object")&&l.util.mixin(l,a.core),typeof a.onInstantiate==="function"&&g(a.onInstantiate)):h("registerPlugin expect an id and an object as parameters",b)},start:f,startSubModule:function(a,b,h,g,e){a=c(a,b,h);f(a.moduleId,a.instanceId,a.opt,e)&&typeof g==="string"&&((g=u[g])||(g=[]),g.push(a.instanceId))},stop:e,startAll:function(a,g){function c(){}if(typeof a==="function")var e=0,e=$.isArray(g)?g.length:l.util.countObjectKeys(s),c=function(){e--;
e===0&&a()};$.isArray(g)?$.each(g,function(a,d){typeof d==="string"?f(d,d,s[d].opt,c):typeof d==="object"?d.j&&d.k?f(d.j,d.l,d.k,c):h("Could not start module from array - invalid parameters",b):h("Could not start module from array",b)}):$.each(s,function(a,d){d&&f(a,a,d.opt,c)})},stopAll:function(){$.each(m,function(a){e(a)})},publish:function(a,b,g){$.each(m,function(c,h){if(h.subscriptions){var e=h.subscriptions[a];e&&$.each(e,function(c,h){if(typeof h==="function")if(typeof b==="object"&&g!==!0){var e=
{};$.extend(!0,e,b);h(e,a)}else h(b,a)})}})},subscribe:function(a,b,g){o("subscribe to '"+b+"'",a,"debug");a=m[a];a.subscriptions||(a.subscriptions={});a=a.subscriptions;a[b]||(a[b]=[]);a[b].push(g)},getContainer:function(a){var b=m[a].opt;if(b&&typeof b.container==="string")return $("#"+b.container);return $("#"+a)},getInstance:function(a){return m[a]},log:o};k[b]=k[b]||l})(window,"scaleApp");(function(k,b,e){function f(e,j,k){if(k)if(typeof j==="object"){f(e,k+":");f(e,j);return}else j=k+": "+j;switch(e){case c.d:a<=c.d&&b.debug(j);break;case c.c:a<=c.c&&b.info(j);break;case c.g:a<=c.g&&b.warn(j);break;case c.f:a<=c.f&&b.error(j);break;case c.e:a<=c.e&&b.error(j);break;default:b.log(j)}}b||(k=function(){},b={log:k,debug:k,info:k,warn:k,error:k,fatal:k});var a=0,c={d:0,c:1,g:2,f:3,e:4};e.log={debug:function(a,b){f(c.d,a,b)},info:function(a,b){f(c.c,a,b)},warn:function(a,b){f(c.g,a,b)},
error:function(a,b){f(c.f,a,b)},fatal:function(a,b){f(c.e,a,b)},setLogLevel:function(b){if(typeof b==="string")switch(b.toLowerCase()){case "debug":a=c.d;break;case "info":a=c.c;break;case "warn":a=c.g;break;case "error":a=c.f;break;case "fatal":a=c.e;break;default:a=c.c}else typeof b==="number"&&(a=b>=c.d&&b<=c.e?b:c.c)},getLogLevel:function(){return a}}})(window,window.console,window.scaleApp);(function(k,b){b.util=b.util||{mixin:function(b,f){function a(a,b){var e={};$.extend(e,a,b);$.extend(b,e)}switch(typeof f+"-"+typeof b){case "function-function":a(f.prototype,b.prototype);break;case "function-object":a(f.prototype,b);break;case "object-object":a(f,b);break;case "object-function":a(f,b.prototype)}},countObjectKeys:function(b){var f=0;if(typeof b==="object")for(var a in b)f++;return f}}})(window,window.scaleApp);(function(k,b){function e(a,h,c){if(a=a[h]){if(!c&&b.util.countObjectKeys(a)===1){for(var e in a)break;return a[e]}return a[c]}}function f(a,b,c,e){a[b]||(a[b]={});a[b][c]=e}function a(a,b,c){typeof c==="object"&&$.each(c,function(c,e){e&&f(a,b,c,e)})}function c(a){typeof a==="object"&&$.each(a,function(a,c){c&&b.util.mixin(c,q)})}function q(){}q.prototype={subscribe:function(a){if(!this.b)this.b=[];this.b.push(a)},unsubscribe:function(a){if(this.b)this.b=this.b.filter(function(b){if(b!==a)return b})},
notify:function(){this.b&&$.each(this.b,function(a,b){typeof b.update==="function"&&b.update()})}};var j={},r={},p={};b.onInstantiate(function(b,e){e.models&&(c(e.models),a(j,b,e.models));e.views&&a(r,b,e.views);e.controllers&&a(p,b,e.controllers)});b.a=b.a||{addModel:function(a,b,c){f(j,a,b,c)},addView:function(a,b,c){f(r,a,b,c)},addController:function(a,b,c){f(p,a,b,c)},getModel:function(a,b){return e(j,a,b)},getView:function(a,b){return e(r,a,b)},getController:function(a,b){return e(p,a,b)},observable:q}})(window,
window.scaleApp);(function(k,b){b.sandbox=b.sandbox||function(e){var f={h:function(a){b.log.debug(a,e)},info:function(a){b.log.info(a,e)},warn:function(a){b.log.warn(a,e)},error:function(a){b.log.error(a,e)},i:function(a){b.log.fatal(a,e)}};return{subscribe:function(a,c){b.subscribe(e,a,c)},unsubscribe:function(a){b.unsubscribe(e,a)},publish:function(a,c,e){b.publish(a,c,e)},startSubModule:function(a,c,f,j){b.startSubModule(a,c,f,e,j)},stopSubModule:function(a){b.stop(a)},getModel:function(a){return b.a.getModel(e,
a)},getView:function(a){return b.a.getView(e,a)},getController:function(a){return b.a.getController(e,a)},addModel:function(a,c){return b.a.addModel(e,a,c)},addView:function(a,c){return b.a.addView(e,a,c)},addController:function(a,c){return b.a.addController(e,a,c)},observable:b.a.observable,getContainer:function(){return b.getContainer(e)},debug:f.h,info:f.info,warn:f.warn,error:f.error,fatal:f.i,mixin:b.util.mixin,count:b.util.countObjectKeys}}})(window,window.scaleApp);
