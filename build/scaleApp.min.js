function l(){return function(){}}
window.scaleApp=function(){function h(c){var i=j[c];if(i)i.destroy(),delete j[c],$.each(k[c],function(c,a){a&&h(a)});else return a.log.error("could not stop instance '"+c+"' - instance does not exist.","core"),!1}function d(c,i,d,b){var e=g(c,i,d);if(e)return a.log.debug("start '"+e.moduleId+"'","core"),f(e.moduleId,e.instanceId,e.opt,function(c){j[e.instanceId]=c;c.init();typeof b==="function"&&b()}),!0;return!1}function g(c,i,b){if(typeof c==="string"&&(typeof i==="string"&&!b||typeof i==="object"&&
!b||typeof i==="string"&&typeof b==="object"||!i&&!b))return typeof i==="object"&&!b&&(b=i,i=c),!i&&!b&&(i=c,b={}),{moduleId:c,instanceId:i,opt:b};a.log.error("could not start module '"+c+"' - illegal arguments.","core")}function e(c,i,d){if(typeof c!=="string")return a.log.error("could not register module- mouduleId has to be a string","core"),!1;if(typeof i!=="function")return a.log.error("could not register module - creator has to be a constructor function","core"),!1;c=i();if(typeof c!=="object"||
typeof c.init!=="function"||typeof c.destroy!=="function")return a.log.error("could not register module - creator has to return an object with the functions 'init' and 'destroy'","core"),!1;if(d&&!b(d))return!1;return!0}function b(c){if(typeof c!=="object")return a.log.error("could not register module - option has to be an object","core"),!1;if(c.views&&typeof c.views!=="object")return!1;if(c.models&&typeof c.models!=="object")return!1;if(c.templates&&typeof c.templates!=="object")return!1;return!0}
function f(c,b,d,f){function e(){typeof f==="function"&&f(j)}var g=m[c],j;if(g){var h={};$.extend(!0,h,g.opt,d);var k=new a.sandbox(b,h);j=g.creator(k);j.opt=h;$.each(n,function(c,a){a(b,h,k)});h.templates&&a.template?a.template.loadMultiple(h.templates).done(function(c){a.template.set(b,c);e()}).fail(l()).then(function(){delete h.templates}):e()}else a.log.error("could not start module '"+c+"' - module does not exist.","core")}var a=this,m={},j={},k={},n=[];return a={register:function(c,a,b){if(!e(c,
a,b))return!1;b||(b={});m[c]={creator:a,opt:b};return!0},onInstantiate:function(c){typeof c==="function"?n.push(c):a.log.error("onInstantiate expect a function as parameter","core")},start:d,startSubModule:function(c,a,b,f){c=g(c,a,b);d(c.moduleId,c.instanceId,c.opt)&&typeof f==="string"&&((f=k[f])||(f=[]),f.push(c.instanceId))},stop:h,startAll:function(c){function b(){}if(typeof c==="function")var f=a.util.countObjectKeys(m),b=function(){f--;f===0&&c()};$.each(m,function(c,a){a&&d(c,c,a.opt,b)})},
stopAll:function(){$.each(j,function(c){h(c)})},publish:function(c,a,b){$.each(j,function(f,d){if(d.subscriptions){var e=d.subscriptions[c];e&&$.each(e,function(f,d){if(typeof d==="function")if(typeof a==="object"&&b!==!0){var e={};$.extend(!0,e,a);d(e,c)}else d(a,c)})}})},subscribe:function(c,b,d){a.log.debug("subscribe to '"+b+"'",c);c=j[c];c.subscriptions||(c.subscriptions={});c=c.subscriptions;c[b]||(c[b]=[]);c[b].push(d)},getContainer:function(c){var a=j[c].opt;if(a&&typeof a.container==="string")return $("#"+
a.container);return $("#"+c)},getInstance:function(c){return j[c]},log:{debug:l(),info:l(),warn:l(),error:l(),fatal:l()}}}(window);scaleApp.log=function(h){function d(b,f,a){if(a)if(typeof f==="object"){d(b,a+":");d(b,f);return}else f=a+": "+f;switch(b){case e.d:g<=e.d&&console.debug(f);break;case e.c:g<=e.c&&console.info(f);break;case e.g:g<=e.g&&console.warn(f);break;case e.f:g<=e.f&&console.error(f);break;case e.e:g<=e.e&&console.error(f);break;default:console.log(f)}}h.console||(h.console={log:l(),debug:l(),info:l(),warn:l(),error:l(),fatal:l()});var g=0,e={d:0,c:1,g:2,f:3,e:4};return{debug:function(b,f){d(e.d,b,f)},info:function(b,
f){d(e.c,b,f)},warn:function(b,f){d(e.g,b,f)},error:function(b,f){d(e.f,b,f)},fatal:function(b,f){d(e.e,b,f)},setLogLevel:function(b){if(typeof b==="string")switch(b.toLowerCase()){case "debug":g=e.d;break;case "info":g=e.c;break;case "warn":g=e.g;break;case "error":g=e.f;break;case "fatal":g=e.e;break;default:g=e.c}else typeof b==="number"&&(g=b>=e.d&&b<=e.e?b:e.c)},getLogLevel:function(){return g}}}(window);scaleApp.i18n=function(h,d){function g(){return(navigator.language||navigator.j||"en").split("-")[0]}var e=g();return{setLanguage:function(b){if(typeof b==="string")return e=b,d.publish("languageChanged",b),!0;return!1},getBrowserLanguage:g,getLanguage:function(){return e},_:function(b,f){var a=d.getInstance(b);if(a.opt&&a.opt.i18n)return a.opt.i18n[e][f]||f;return f}}}(window,window.scaleApp);scaleApp.util=scaleApp.util||{mixin:function(h,d){function g(d,b){var f={};$.extend(f,d,b);$.extend(b,f)}switch(typeof d+"-"+typeof h){case "function-function":g(d.prototype,h.prototype);break;case "function-object":g(d.prototype,h);break;case "object-object":g(d,h);break;case "object-function":g(d,h.prototype)}},countObjectKeys:function(h){var d=0;if(typeof h==="object")for(var g in h)d++;return d}};scaleApp.template=scaleApp.template||function(h,d){function g(b){var d=$.Deferred();typeof b==="string"?$.get(b).done(function(a){d.resolve($('<script type="text/x-jquery-tmpl">'+a+"<\/script>").template())}).fail(function(){d.reject("Could not load the template")}):d.reject("function argument has to be a string");return d.promise()}var e={};return{load:g,loadMultiple:function(b){function d(a){return function(c){h[a]=c}}var a=$.Deferred(),e=[],h={},k;for(k in b)e.push(g(b[k]).done(new d(k)));$.when.apply(null,
e).done(function(){a.resolve(h)});return a.promise()},get:function(b,d){var a=e[b];if(a){if(!d&&$(a).length==1){for(var g in a)break;return a[g]}return a[d]}},add:function(b,f,a){typeof b==="string"&&typeof f==="string"&&typeof a==="function"?(e[b]||(e[b]={}),e[b][f]=a):d.log.error("could not add template: invalid parameters","template")},set:function(b,f){typeof b==="string"&&typeof f==="object"?e[b]=f:d.log.error("could not set templates: invalid parameters","template")}}}(window,window.scaleApp);scaleApp.a=scaleApp.a||function(h,d){function g(a,c,b){if(a=a[c]){if(!b&&d.util.countObjectKeys(a)==1){for(var e in a)break;return a[e]}return a[b]}}function e(a,c,b,d){a[c]||(a[c]={});a[c][b]=d}function b(a,c,b){typeof b==="object"&&$.each(b,function(b,d){d&&e(a,c,b,d)})}function f(b){typeof b==="object"&&$.each(b,function(c,b){b&&d.util.mixin(b,a)})}function a(){}a.prototype={subscribe:function(a){if(!this.b)this.b=[];this.b.push(a)},unsubscribe:function(a){if(this.b)this.b=this.b.filter(function(c){if(c!==
a)return c})},notify:function(){this.b&&$.each(this.b,function(a,c){typeof c.update==="function"&&c.update()})}};var m={},j={},k={};d.onInstantiate(function(a,c){c.models&&(f(c.models),b(m,a,c.models));c.views&&b(j,a,c.views);c.controllers&&b(k,a,c.controllers)});return{addModel:function(a,c,b){e(m,a,c,b)},addView:function(a,c,b){e(j,a,c,b)},addController:function(a,c,b){e(k,a,c,b)},getModel:function(a,c){return g(m,a,c)},getView:function(a,c){return g(j,a,c)},getController:function(a,c){return g(k,
a,c)},observable:a}}(window,window.scaleApp);window.scaleApp.sandbox=window.scaleApp.sandbox||function(h,d){return function(g){function e(a){return d.template.get(g,a)}function b(a,b){d.publish(a,b)}var f={h:function(a){d.log.debug(a,g)},info:function(a){d.log.info(a,g)},warn:function(a){d.log.warn(a,g)},error:function(a){d.log.error(a,g)},i:function(a){d.log.fatal(a,g)}};return{subscribe:function(a,b){d.subscribe(g,a,b)},unsubscribe:function(a){d.unsubscribe(g,a)},publish:b,startSubModule:function(a,b,e){d.startSubModule(a,b,e,g)},stopSubModule:function(a){d.stop(a)},
getModel:function(a){return d.a.getModel(g,a)},getView:function(a){return d.a.getView(g,a)},getController:function(a){return d.a.getController(g,a)},addModel:function(a,b){return d.a.addModel(g,a,b)},addView:function(a,b){return d.a.addView(g,a,b)},addController:function(a,b){return d.a.addController(g,a,b)},observable:d.a.observable,getTemplate:e,tmpl:function(a,b){if(typeof a==="string")return $.tmpl(e(a),b);else if(typeof a==="function")return $.tmpl(a,b);else f.error("type of 'id' is not valid",
"sandbox of "+g)},getContainer:function(){return d.getContainer(g)},debug:f.h,info:f.info,warn:f.warn,error:f.error,fatal:f.i,mixin:d.util.mixin,count:d.util.countObjectKeys,_:function(a){return d.i18n._(g,a)},getLanguage:d.i18n.getLanguage,hotkeys:function(a,d,e,f){typeof d==="string"?(f||(f="keypress"),$(document).bind(f,a,function(){b(d,e)})):typeof d==="function"&&(e||(e="keypress"),$(document).bind(e,a,d))}}}}(window,window.scaleApp);
