function k(){return function(){}}
window.scaleApp=function(){function h(d){var a=i[d];if(a)a.destroy(),delete i[d],$.each(j[d],function(d,b){b&&h(b)});else return b.log.error("could not stop instance '"+d+"' - instance does not exist.","core"),!1}function a(d,a,e,g){var m=f(d,a,e);if(m)return b.log.debug("start '"+m.moduleId+"'","core"),c(m.moduleId,m.instanceId,m.opt,function(d){i[m.instanceId]=d;d.init();typeof g==="function"&&g()}),!0;return!1}function f(d,a,e){if(typeof d==="string"&&(typeof a==="string"&&!e||typeof a==="object"&&
!e||typeof a==="string"&&typeof e==="object"||!a&&!e))return typeof a==="object"&&!e&&(e=a,a=d),!a&&!e&&(a=d,e={}),{moduleId:d,instanceId:a,opt:e};b.log.error("could not start module '"+d+"' - illegal arguments.","core")}function g(d,a,c){if(typeof d!=="string")return b.log.error("could not register module- mouduleId has to be a string","core"),!1;if(typeof a!=="function")return b.log.error("could not register module - creator has to be a constructor function","core"),!1;d=a();if(typeof d!=="object"||
typeof d.init!=="function"||typeof d.destroy!=="function")return b.log.error("could not register module - creator has to return an object with the functions 'init' and 'destroy'","core"),!1;if(c&&!e(c))return!1;return!0}function e(d){if(typeof d!=="object")return b.log.error("could not register module - option has to be an object","core"),!1;if(d.views&&typeof d.views!=="object")return!1;if(d.models&&typeof d.models!=="object")return!1;if(d.templates&&typeof d.templates!=="object")return!1;return!0}
function c(d,a,e,c){function f(){typeof c==="function"&&c(i)}var g=l[d],i;if(g){var h={};$.extend(!0,h,g.opt,e);var j=new b.sandbox(a,h);i=g.creator(j);i.opt=h;$.each(m,function(d,b){b(a,h,j)});h.templates&&b.template?b.template.loadMultiple(h.templates).done(function(d){b.template.set(a,d);f()}).fail(k()).then(function(){delete h.templates}):f()}else b.log.error("could not start module '"+d+"' - module does not exist.","core")}var b=this,l={},i={},j={},m=[];return b={register:function(d,b,a){if(!g(d,
b,a))return!1;a||(a={});l[d]={creator:b,opt:a};return!0},onInstantiate:function(d){typeof d==="function"?m.push(d):b.log.error("onInstantiate expect a function as parameter","core")},start:a,startSubModule:function(d,b,e,c){d=f(d,b,e);a(d.moduleId,d.instanceId,d.opt)&&typeof c==="string"&&((c=j[c])||(c=[]),c.push(d.instanceId))},stop:h,startAll:function(d){function e(){}if(typeof d==="function")var c=b.util.countObjectKeys(l),e=function(){c--;c===0&&d()};$.each(l,function(d,b){b&&a(d,d,b.opt,e)})},
stopAll:function(){$.each(i,function(d){h(d)})},publish:function(d,b){$.each(i,function(a,e){if(e.subscriptions){var c=e.subscriptions[d];c&&$.each(c,function(a,e){typeof e==="function"&&e(b,d)})}})},subscribe:function(d,a,e){b.log.debug("subscribe to '"+a+"'",d);d=i[d];d.subscriptions||(d.subscriptions={});d=d.subscriptions;d[a]||(d[a]=[]);d[a].push(e)},getContainer:function(d){var b=i[d].opt;if(b&&typeof b.container==="string")return $("#"+b.container);return $("#"+d)},getInstance:function(d){return i[d]},
log:{debug:k(),info:k(),warn:k(),error:k(),fatal:k()}}}(window);scaleApp.log=function(h){function a(e,c,b){if(b)if(typeof c==="object"){a(e,b+":");a(e,c);return}else c=b+": "+c;switch(e){case g.c:f<=g.c&&console.debug(c);break;case g.b:f<=g.b&&console.info(c);break;case g.f:f<=g.f&&console.warn(c);break;case g.e:f<=g.e&&console.error(c);break;case g.d:f<=g.d&&console.error(c);break;default:console.log(c)}}h.console||(h.console={log:k(),debug:k(),info:k(),warn:k(),error:k(),fatal:k()});var f=0,g={c:0,b:1,f:2,e:3,d:4};return{debug:function(e,c){a(g.c,e,c)},info:function(e,
c){a(g.b,e,c)},warn:function(e,c){a(g.f,e,c)},error:function(e,c){a(g.e,e,c)},fatal:function(e,c){a(g.d,e,c)},setLogLevel:function(a){if(typeof a==="string")switch(a.toLowerCase()){case "debug":f=g.c;break;case "info":f=g.b;break;case "warn":f=g.f;break;case "error":f=g.e;break;case "fatal":f=g.d;break;default:f=g.b}else typeof a==="number"&&(f=a>=g.c&&a<=g.d?a:g.b)},getLogLevel:function(){return f}}}(window);window.scaleApp.i18n=window.scaleApp.i18n||function(h,a){function f(){return(navigator.language||navigator.i||"en").split("-")[0]}var g=f();return{setLanguage:function(e){if(typeof e==="string")return g=e,a.publish("languageChanged",e),!0;return!1},getBrowserLanguage:f,getLanguage:function(){return g},_:function(e,c){var b=a.getInstance(e);if(b.opt&&b.opt.i18n)return b.opt.i18n[g][c];return""}}}(window,window.scaleApp);scaleApp.util=scaleApp.util||{mixin:function(h,a){function f(a,e){var c={};$.extend(c,a,e);$.extend(e,c)}switch(typeof a+"-"+typeof h){case "function-function":f(a.prototype,h.prototype);break;case "function-object":f(a.prototype,h);break;case "object-object":f(a,h);break;case "object-function":f(a,h.prototype)}},countObjectKeys:function(h){var a=0;if(typeof h==="object")for(var f in h)a++;return a}};window.scaleApp.template=window.scaleApp.template||function(h,a){function f(a){var c=$.Deferred();typeof a==="string"?$.get(a).done(function(a){c.resolve($('<script type="text/x-jquery-tmpl">'+a+"<\/script>").template())}).fail(function(){c.reject("Could not load the template")}):c.reject("function argument has to be a string");return c.promise()}var g={};return{load:f,loadMultiple:function(a){function c(a){return function(d){h[a]=d}}var b=$.Deferred(),g=[],h={},j;for(j in a)g.push(f(a[j]).done(new c(j)));
$.when.apply(null,g).done(function(){b.resolve(h)});return b.promise()},get:function(a,c){var b=g[a];if(b){if(!c&&$(b).length==1){for(var f in b)break;return b[f]}return b[c]}},add:function(e,c,b){typeof e==="string"&&typeof c==="string"&&typeof b==="function"?(g[e]||(g[e]={}),g[e][c]=b):a.log.error("could not add template: invalid parameters","template")},set:function(e,c){typeof e==="string"&&typeof c==="object"?g[e]=c:a.log.error("could not set templates: invalid parameters","template")}}}(window,
window.scaleApp);window.scaleApp.mvc=window.scaleApp.mvc||function(h,a){function f(b,d,c){if(b=b[d]){if(!c&&a.util.countObjectKeys(b)==1){for(var e in b)break;return b[e]}return b[c]}}function g(a,d,b,c){a[d]||(a[d]={});a[d][b]=c}function e(a,d,b){typeof b==="object"&&$.each(b,function(b,c){c&&g(a,d,b,c)})}function c(c){typeof c==="object"&&$.each(c,function(d,c){c&&a.util.mixin(c,b)})}function b(){}b.prototype={subscribe:function(a){if(!this.a)this.a=[];this.a.push(a)},unsubscribe:function(a){if(this.a)this.a=this.a.filter(function(b){if(b!==
a)return b})},notify:function(){this.a&&$.each(this.a,function(a,b){typeof b.update==="function"&&b.update()})}};var l={},i={},j={};a.onInstantiate(function(b,d){a.log.debug("adding opts");a.log.debug(d);d.models&&(c(d.models),e(l,b,d.models));d.views&&e(i,b,d.views);d.controllers&&e(j,b,d.controllers);a.log.debug("added ops");a.log.debug(l);a.log.debug(i);a.log.debug(j)});return{addModel:function(b,a,c){g(l,b,a,c)},addView:function(b,a,c){g(i,b,a,c)},addController:function(b,a,c){g(j,b,a,c)},getModel:function(b,
a){return f(l,b,a)},getView:function(b,a){return f(i,b,a)},getController:function(b,a){return f(j,b,a)},observable:b}}(window,window.scaleApp);window.scaleApp.sandbox=window.scaleApp.sandbox||function(h,a){return function(f){function g(b){return a.template.get(f,b)}function e(b,c){a.publish(b,c)}var c={g:function(b){a.log.debug(b,f)},info:function(b){a.log.info(b,f)},warn:function(b){a.log.warn(b,f)},error:function(b){a.log.error(b,f)},h:function(b){a.log.fatal(b,f)}};return{subscribe:function(b,c){a.subscribe(f,b,c)},unsubscribe:function(b){a.unsubscribe(f,b)},publish:e,startSubModule:function(b,c,e){a.startSubModule(b,c,e,f)},stopSubModule:function(b){a.stop(b)},
getModel:function(b){return a.mvc.getModel(f,b)},getView:function(b){return a.mvc.getView(f,b)},getController:function(b){return a.mvc.getController(f,b)},addModel:function(b,c){return a.mvc.addModel(f,b,c)},addView:function(b,c){return a.mvc.addView(f,b,c)},addController:function(b,c){return a.mvc.addController(f,b,c)},observable:a.mvc.observable,getTemplate:g,tmpl:function(a,e){if(typeof a==="string")return $.tmpl(g(a),e);else if(typeof a==="function")return $.tmpl(a,e);else c.error("type of 'id' is not valid",
"sandbox of "+f)},getContainer:function(){return a.getContainer(f)},debug:c.g,info:c.info,warn:c.warn,error:c.error,fatal:c.h,mixin:a.util.mixin,count:a.util.countObjectKeys,_:function(b){return a.i18n._(f,b)},getLanguage:a.i18n.getLanguage,hotkeys:function(a,c,f,g){typeof c==="string"?(g||(g="keypress"),$(document).bind(g,a,function(){e(c,f)})):typeof c==="function"&&(f||(f="keypress"),$(document).bind(f,a,c))}}}}(window,window.scaleApp);
