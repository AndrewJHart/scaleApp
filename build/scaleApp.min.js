function l(){return function(){}}
window.scaleApp=function(){function g(c){var h=j[c];if(h)h.destroy(),delete j[c],$.each(k[c],function(c,a){a&&g(a)});else return a.log.error("could not stop instance '"+c+"' - instance does not exist.","core"),!1}function e(c,h,e,d){var f=b(c,h,e);if(f)return a.log.debug("start '"+f.moduleId+"'","core"),i(f.moduleId,f.instanceId,f.opt,function(c){j[f.instanceId]=c;c.init();typeof d==="function"&&d()}),!0;return!1}function b(c,h,d){if(typeof c==="string"&&(typeof h==="string"&&!d||typeof h==="object"&&
!d||typeof h==="string"&&typeof d==="object"||!h&&!d))return typeof h==="object"&&!d&&(d=h,h=c),!h&&!d&&(h=c,d={}),{moduleId:c,instanceId:h,opt:d};a.log.error("could not start module '"+c+"' - illegal arguments.","core")}function f(c,h,e){if(typeof c!=="string")return a.log.error("could not register module- mouduleId has to be a string","core"),!1;if(typeof h!=="function")return a.log.error("could not register module - creator has to be a constructor function","core"),!1;c=h();if(typeof c!=="object"||
typeof c.init!=="function"||typeof c.destroy!=="function")return a.log.error("could not register module - creator has to return an object with the functions 'init' and 'destroy'","core"),!1;if(e&&!d(e))return!1;return!0}function d(c){if(typeof c!=="object")return a.log.error("could not register module - option has to be an object","core"),!1;if(c.views&&typeof c.views!=="object")return!1;if(c.models&&typeof c.models!=="object")return!1;if(c.templates&&typeof c.templates!=="object")return!1;return!0}
function i(c,d,e,f){function i(){typeof f==="function"&&f(j)}var b=m[c],j;if(b){var g={};$.extend(!0,g,b.opt,e);var k=new a.sandbox(d,g);j=b.creator(k);j.opt=g;$.each(n,function(c,a){a(d,g,k)});g.templates&&a.template?a.template.loadMultiple(g.templates).done(function(c){a.template.set(d,c);i()}).fail(l()).then(function(){delete g.templates}):i()}else a.log.error("could not start module '"+c+"' - module does not exist.","core")}var a=this,m={},j={},k={},n=[];return a={register:function(c,a,d){if(!f(c,
a,d))return!1;d||(d={});m[c]={creator:a,opt:d};return!0},onInstantiate:function(c){typeof c==="function"?n.push(c):a.log.error("onInstantiate expect a function as parameter","core")},start:e,startSubModule:function(c,a,d,f){c=b(c,a,d);e(c.moduleId,c.instanceId,c.opt)&&typeof f==="string"&&((f=k[f])||(f=[]),f.push(c.instanceId))},stop:g,startAll:function(c){function d(){}if(typeof c==="function")var f=a.util.countObjectKeys(m),d=function(){f--;f===0&&c()};$.each(m,function(c,a){a&&e(c,c,a.opt,d)})},
stopAll:function(){$.each(j,function(c){g(c)})},publish:function(c,a,d){$.each(j,function(f,e){if(e.subscriptions){var b=e.subscriptions[c];b&&$.each(b,function(f,e){if(typeof e==="function")if(typeof a==="object"&&d!==!0){var b={};$.extend(!0,b,a);e(b,c)}else e(a,c)})}})},subscribe:function(c,d,e){a.log.debug("subscribe to '"+d+"'",c);c=j[c];c.subscriptions||(c.subscriptions={});c=c.subscriptions;c[d]||(c[d]=[]);c[d].push(e)},getContainer:function(c){var a=j[c].opt;if(a&&typeof a.container==="string")return $("#"+
a.container);return $("#"+c)},getInstance:function(c){return j[c]},log:{debug:l(),info:l(),warn:l(),error:l(),fatal:l()}}}(window);scaleApp.log=function(g){function e(d,i,a){if(a)if(typeof i==="object"){e(d,a+":");e(d,i);return}else i=a+": "+i;switch(d){case f.d:b<=f.d&&console.debug(i);break;case f.c:b<=f.c&&console.info(i);break;case f.g:b<=f.g&&console.warn(i);break;case f.f:b<=f.f&&console.error(i);break;case f.e:b<=f.e&&console.error(i);break;default:console.log(i)}}g.console||(g.console={log:l(),debug:l(),info:l(),warn:l(),error:l(),fatal:l()});var b=0,f={d:0,c:1,g:2,f:3,e:4};return{debug:function(d,b){e(f.d,d,b)},info:function(d,
b){e(f.c,d,b)},warn:function(d,b){e(f.g,d,b)},error:function(d,b){e(f.f,d,b)},fatal:function(d,b){e(f.e,d,b)},setLogLevel:function(d){if(typeof d==="string")switch(d.toLowerCase()){case "debug":b=f.d;break;case "info":b=f.c;break;case "warn":b=f.g;break;case "error":b=f.f;break;case "fatal":b=f.e;break;default:b=f.c}else typeof d==="number"&&(b=d>=f.d&&d<=f.e?d:f.c)},getLogLevel:function(){return b}}}(window);scaleApp.i18n=function(g,e){function b(){return(navigator.language||navigator.j||"en").split("-")[0]}var f=b();return{setLanguage:function(d){if(typeof d==="string")return f=d,e.publish("languageChanged",d),!0;return!1},getBrowserLanguage:b,getLanguage:function(){return f},_:function(d,b){var a=e.getInstance(d);if(a.opt&&a.opt.i18n)return a.opt.i18n[f][b];return""}}}(window,window.scaleApp);scaleApp.util=scaleApp.util||{mixin:function(g,e){function b(b,d){var e={};$.extend(e,b,d);$.extend(d,e)}switch(typeof e+"-"+typeof g){case "function-function":b(e.prototype,g.prototype);break;case "function-object":b(e.prototype,g);break;case "object-object":b(e,g);break;case "object-function":b(e,g.prototype)}},countObjectKeys:function(g){var e=0;if(typeof g==="object")for(var b in g)e++;return e}};scaleApp.template=scaleApp.template||function(g,e){function b(d){var b=$.Deferred();typeof d==="string"?$.get(d).done(function(a){b.resolve($('<script type="text/x-jquery-tmpl">'+a+"<\/script>").template())}).fail(function(){b.reject("Could not load the template")}):b.reject("function argument has to be a string");return b.promise()}var f={};return{load:b,loadMultiple:function(d){function e(a){return function(c){g[a]=c}}var a=$.Deferred(),f=[],g={},k;for(k in d)f.push(b(d[k]).done(new e(k)));$.when.apply(null,
f).done(function(){a.resolve(g)});return a.promise()},get:function(d,b){var a=f[d];if(a){if(!b&&$(a).length==1){for(var e in a)break;return a[e]}return a[b]}},add:function(d,b,a){typeof d==="string"&&typeof b==="string"&&typeof a==="function"?(f[d]||(f[d]={}),f[d][b]=a):e.log.error("could not add template: invalid parameters","template")},set:function(d,b){typeof d==="string"&&typeof b==="object"?f[d]=b:e.log.error("could not set templates: invalid parameters","template")}}}(window,window.scaleApp);scaleApp.a=scaleApp.a||function(g,e){function b(a,c,b){if(a=a[c]){if(!b&&e.util.countObjectKeys(a)==1){for(var d in a)break;return a[d]}return a[b]}}function f(a,c,b,d){a[c]||(a[c]={});a[c][b]=d}function d(a,c,b){typeof b==="object"&&$.each(b,function(b,d){d&&f(a,c,b,d)})}function i(b){typeof b==="object"&&$.each(b,function(c,b){b&&e.util.mixin(b,a)})}function a(){}a.prototype={subscribe:function(a){if(!this.b)this.b=[];this.b.push(a)},unsubscribe:function(a){if(this.b)this.b=this.b.filter(function(c){if(c!==
a)return c})},notify:function(){this.b&&$.each(this.b,function(a,c){typeof c.update==="function"&&c.update()})}};var m={},j={},k={};e.onInstantiate(function(a,c){c.models&&(i(c.models),d(m,a,c.models));c.views&&d(j,a,c.views);c.controllers&&d(k,a,c.controllers)});return{addModel:function(a,c,b){f(m,a,c,b)},addView:function(a,c,b){f(j,a,c,b)},addController:function(a,c,b){f(k,a,c,b)},getModel:function(a,c){return b(m,a,c)},getView:function(a,c){return b(j,a,c)},getController:function(a,c){return b(k,
a,c)},observable:a}}(window,window.scaleApp);window.scaleApp.sandbox=window.scaleApp.sandbox||function(g,e){return function(b){function f(a){return e.template.get(b,a)}function d(a,b){e.publish(a,b)}var g={h:function(a){e.log.debug(a,b)},info:function(a){e.log.info(a,b)},warn:function(a){e.log.warn(a,b)},error:function(a){e.log.error(a,b)},i:function(a){e.log.fatal(a,b)}};return{subscribe:function(a,d){e.subscribe(b,a,d)},unsubscribe:function(a){e.unsubscribe(b,a)},publish:d,startSubModule:function(a,d,f){e.startSubModule(a,d,f,b)},stopSubModule:function(a){e.stop(a)},
getModel:function(a){return e.a.getModel(b,a)},getView:function(a){return e.a.getView(b,a)},getController:function(a){return e.a.getController(b,a)},addModel:function(a,d){return e.a.addModel(b,a,d)},addView:function(a,d){return e.a.addView(b,a,d)},addController:function(a,d){return e.a.addController(b,a,d)},observable:e.a.observable,getTemplate:f,tmpl:function(a,d){if(typeof a==="string")return $.tmpl(f(a),d);else if(typeof a==="function")return $.tmpl(a,d);else g.error("type of 'id' is not valid",
"sandbox of "+b)},getContainer:function(){return e.getContainer(b)},debug:g.h,info:g.info,warn:g.warn,error:g.error,fatal:g.i,mixin:e.util.mixin,count:e.util.countObjectKeys,_:function(a){return e.i18n._(b,a)},getLanguage:e.i18n.getLanguage,hotkeys:function(a,b,e,f){typeof b==="string"?(f||(f="keypress"),$(document).bind(f,a,function(){d(b,e)})):typeof b==="function"&&(e||(e="keypress"),$(document).bind(e,a,b))}}}}(window,window.scaleApp);
