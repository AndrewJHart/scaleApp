(function(h,c){function d(a){var b=k[a];if(b)b.destroy(),delete k[a],$.each(p[a],function(a,b){b&&d(b)});else return i("could not stop instance '"+a+"' - instance does not exist.",c),!1}function f(a,b,g,d){return typeof a==="string"&&(typeof b==="string"&&!g||typeof b==="object"&&!g||typeof b==="string"&&typeof g==="object"||!b&&!g)||$.isArray(a)&&!b&&!g?e(a,b,g,d):(i("could not start module '"+a+"' - illegal arguments.",c),!1)}function e(b,e,g,d){var f=a(b,e,g);if(f)return l("start '"+f.moduleId+
"'",c,"debug"),m(f.moduleId,f.instanceId,f.opt,function(a){k[f.instanceId]=a;a.init(a.opt);typeof d==="function"&&d()}),!0;return!1}function a(a,b,c){typeof b==="object"&&!c&&(c=b,b=a);!b&&!c&&(b=a,c={});return{moduleId:a,instanceId:b,opt:c}}function b(a,b,e){if(typeof a!=="string")return i("could not register module- mouduleId has to be a string",c),!1;if(typeof b!=="function")return i("could not register module - creator has to be a constructor function",c),!1;a=b();if(typeof a!=="object"||typeof a.init!==
"function"||typeof a.destroy!=="function")return i("could not register module - creator has to return an object with the functions 'init' and 'destroy'",c),!1;if(e&&!j(e))return!1;return!0}function j(a){if(typeof a!=="object")return i("could not register module - option has to be an object",c),!1;if(a.views&&typeof a.views!=="object")return!1;if(a.models&&typeof a.models!=="object")return!1;if(a.templates&&typeof a.templates!=="object")return!1;return!0}function m(a,b,e,f){function d(){typeof f===
"function"&&f(j)}var l=n[a],j;if(l){var i={};$.extend(!0,i,l.opt,e);var h=new g.sandbox(b,i);$.each(o,function(a,b){var c=new b(h);$.extend(!0,h,c)});j=l.creator(h);j.opt=i;$.each(q,function(a,c){c(b,i,h)});i.templates&&g.template?g.template.loadMultiple(i.templates).done(function(a){g.template.set(b,a);d()}).fail(function(){}).then(function(){delete i.templates}):d()}else(void 0)("could not start module '"+a+"' - module does not exist.",c)}function i(a,b){l(a,b,"error")}function l(a,b,c){if(g.log&&
typeof g.log[c]==="function")g.log[c](a,b)}var g=this,n={},k={},p={},o={},q=[],g={register:function(a,c,e){if(!b(a,c,e))return!1;e||(e={});n[a]={creator:c,opt:e};return!0},onInstantiate:function(a){typeof a==="function"?q.push(a):i("onInstantiate expect a function as parameter",c)},addPlugin:function(a,b){typeof a==="string"&&typeof b==="function"?o[a]=o[a]||b:i("addPluggin expect an id and a function as parameters",c)},start:f,startSubModule:function(b,c,e,g,d){b=a(b,c,e);f(b.moduleId,b.instanceId,
b.opt,d)&&typeof g==="string"&&((g=p[g])||(g=[]),g.push(b.instanceId))},stop:d,startAll:function(a,b){function e(){}if(typeof a==="function")var d=0,d=$.isArray(b)?b.length:g.util.countObjectKeys(n),e=function(){d--;d===0&&a()};$.isArray(b)?$.each(b,function(a,b){typeof b==="string"?f(b,b,n[b].opt,e):typeof b==="object"?b.j&&b.k?f(b.j,b.m,b.k,e):i("Could not start module from array - invalid parameters",c):i("Could not start module from array",c)}):$.each(n,function(a,b){b&&f(a,a,b.opt,e)})},stopAll:function(){$.each(k,
function(a){d(a)})},publish:function(a,b,c){$.each(k,function(e,g){if(g.subscriptions){var d=g.subscriptions[a];d&&$.each(d,function(e,g){if(typeof g==="function")if(typeof b==="object"&&c!==!0){var d={};$.extend(!0,d,b);g(d,a)}else g(b,a)})}})},subscribe:function(a,b,c){l("subscribe to '"+b+"'",a,"debug");a=k[a];a.subscriptions||(a.subscriptions={});a=a.subscriptions;a[b]||(a[b]=[]);a[b].push(c)},getContainer:function(a){var b=k[a].opt;if(b&&typeof b.container==="string")return $("#"+b.container);
return $("#"+a)},getInstance:function(a){return k[a]},log:l};h[c]=h[c]||g})(window,"scaleApp");(function(h,c,d){function f(b,d,h){if(h)if(typeof d==="object"){f(b,h+":");f(b,d);return}else d=h+": "+d;switch(b){case a.d:e<=a.d&&c.debug(d);break;case a.c:e<=a.c&&c.info(d);break;case a.g:e<=a.g&&c.warn(d);break;case a.f:e<=a.f&&c.error(d);break;case a.e:e<=a.e&&c.error(d);break;default:c.log(d)}}c||(h=function(){},c={log:h,debug:h,info:h,warn:h,error:h,fatal:h});var e=0,a={d:0,c:1,g:2,f:3,e:4};d.log={debug:function(b,c){f(a.d,b,c)},info:function(b,c){f(a.c,b,c)},warn:function(b,c){f(a.g,b,c)},
error:function(b,c){f(a.f,b,c)},fatal:function(b,c){f(a.e,b,c)},setLogLevel:function(b){if(typeof b==="string")switch(b.toLowerCase()){case "debug":e=a.d;break;case "info":e=a.c;break;case "warn":e=a.g;break;case "error":e=a.f;break;case "fatal":e=a.e;break;default:e=a.c}else typeof b==="number"&&(e=b>=a.d&&b<=a.e?b:a.c)},getLogLevel:function(){return e}}})(window,window.console,window.scaleApp);(function(h,c){function d(){return(navigator.language||navigator.l||"en").split("-")[0]}var f=d();c.i18n=c.i18n||{setLanguage:function(e){if(typeof e==="string")return f=e,c.publish("languageChanged",e),!0;return!1},getBrowserLanguage:d,getLanguage:function(){return f},_:function(e,a){var b=c.getInstance(e);if(b.opt&&b.opt.i18n)if(b=b.opt.i18n,b[f]&&b[f][a])return b[f][a];else{var d=f.substring(0,2);if(b[d]&&b[d][a])return b[d][a];else if(b.en&&b.en[a])return b.en[a]}return a}}})(window,window.scaleApp);(function(h,c){c.util=c.util||{mixin:function(c,f){function e(a,b){var c={};$.extend(c,a,b);$.extend(b,c)}switch(typeof f+"-"+typeof c){case "function-function":e(f.prototype,c.prototype);break;case "function-object":e(f.prototype,c);break;case "object-object":e(f,c);break;case "object-function":e(f,c.prototype)}},countObjectKeys:function(c){var f=0;if(typeof c==="object")for(var e in c)f++;return f}}})(window,window.scaleApp);(function(h,c){function d(c){var a=$.Deferred();typeof c==="string"?$.get(c).done(function(b){a.resolve($('<script type="text/x-jquery-tmpl">'+b+"<\/script>").template())}).fail(function(){a.reject("Could not load the template")}):a.reject("function argument has to be a string");return a.promise()}var f={};c.template=c.template||{load:d,loadMultiple:function(c){function a(a){return function(b){h[a]=b}}var b=$.Deferred(),f=[],h={},i;for(i in c)f.push(d(c[i]).done(new a(i)));$.when.apply(null,f).done(function(){b.resolve(h)});
return b.promise()},get:function(c,a){var b=f[c];if(b){if(!a&&$(b).length===1){for(var d in b)break;return b[d]}return b[a]}},add:function(d,a,b){typeof d==="string"&&typeof a==="string"&&typeof b==="function"?(f[d]||(f[d]={}),f[d][a]=b):c.log.error("could not add template: invalid parameters","template")},set:function(d,a){typeof d==="string"&&typeof a==="object"?f[d]=a:c.log.error("could not set templates: invalid parameters","template")}}})(window,window.scaleApp);(function(h,c){function d(a,b,d){if(a=a[b]){if(!d&&c.util.countObjectKeys(a)===1){for(var e in a)break;return a[e]}return a[d]}}function f(a,b,c,d){a[b]||(a[b]={});a[b][c]=d}function e(a,b,c){typeof c==="object"&&$.each(c,function(c,d){d&&f(a,b,c,d)})}function a(a){typeof a==="object"&&$.each(a,function(a,d){d&&c.util.mixin(d,b)})}function b(){}b.prototype={subscribe:function(a){if(!this.b)this.b=[];this.b.push(a)},unsubscribe:function(a){if(this.b)this.b=this.b.filter(function(b){if(b!==a)return b})},
notify:function(){this.b&&$.each(this.b,function(a,b){typeof b.update==="function"&&b.update()})}};var j={},m={},i={};c.onInstantiate(function(b,c){c.models&&(a(c.models),e(j,b,c.models));c.views&&e(m,b,c.views);c.controllers&&e(i,b,c.controllers)});c.a=c.a||{addModel:function(a,b,c){f(j,a,b,c)},addView:function(a,b,c){f(m,a,b,c)},addController:function(a,b,c){f(i,a,b,c)},getModel:function(a,b){return d(j,a,b)},getView:function(a,b){return d(m,a,b)},getController:function(a,b){return d(i,a,b)},observable:b}})(window,
window.scaleApp);(function(h,c){c.sandbox=c.sandbox||function(d){function f(a){return c.template.get(d,a)}var e={h:function(a){c.log.debug(a,d)},info:function(a){c.log.info(a,d)},warn:function(a){c.log.warn(a,d)},error:function(a){c.log.error(a,d)},i:function(a){c.log.fatal(a,d)}};return{subscribe:function(a,b){c.subscribe(d,a,b)},unsubscribe:function(a){c.unsubscribe(d,a)},publish:function(a,b,d){c.publish(a,b,d)},startSubModule:function(a,b,e,f){c.startSubModule(a,b,e,d,f)},stopSubModule:function(a){c.stop(a)},
getModel:function(a){return c.a.getModel(d,a)},getView:function(a){return c.a.getView(d,a)},getController:function(a){return c.a.getController(d,a)},addModel:function(a,b){return c.a.addModel(d,a,b)},addView:function(a,b){return c.a.addView(d,a,b)},addController:function(a,b){return c.a.addController(d,a,b)},observable:c.a.observable,getTemplate:f,tmpl:function(a,b){if(typeof a==="string")return $.tmpl(f(a),b);else if(typeof a==="function")return $.tmpl(a,b);else e.error("type of 'id' is not valid",
"sandbox of "+d)},getContainer:function(){return c.getContainer(d)},debug:e.h,info:e.info,warn:e.warn,error:e.error,fatal:e.i,mixin:c.util.mixin,count:c.util.countObjectKeys,_:function(a){return c.i18n._(d,a)},getLanguage:c.i18n.getLanguage}}})(window,window.scaleApp);
