(function(i,c){function e(a){var b=k[a];if(b)b.destroy(),delete k[a],$.each(p[a],function(a,o){o&&e(o)});else return h("could not stop instance '"+a+"' - instance does not exist.",c),!1}function f(a,b,g,j){return typeof a==="string"&&(typeof b==="string"&&!g||typeof b==="object"&&!g||typeof b==="string"&&typeof g==="object"||!b&&!g)||$.isArray(a)&&!b&&!g?d(a,b,g,j):(h("could not start module '"+a+"' - illegal arguments.",c),!1)}function d(a,g,d,j){var e=b(a,g,d);if(e)return l("start '"+e.moduleId+
"'",c,"debug"),m(e.moduleId,e.instanceId,e.opt,function(a){k[e.instanceId]=a;a.init(a.opt);typeof j==="function"&&j()}),!0;return!1}function b(a,b,c){typeof b==="object"&&!c&&(c=b,b=a);!b&&!c&&(b=a,c={});return{moduleId:a,instanceId:b,opt:c}}function a(a,b,d){if(typeof a!=="string")return h("could not register module- mouduleId has to be a string",c),!1;if(typeof b!=="function")return h("could not register module - creator has to be a constructor function",c),!1;a=b();if(typeof a!=="object"||typeof a.init!==
"function"||typeof a.destroy!=="function")return h("could not register module - creator has to return an object with the functions 'init' and 'destroy'",c),!1;if(d&&!g(d))return!1;return!0}function g(a){if(typeof a!=="object")return h("could not register module - option has to be an object",c),!1;if(a.views&&typeof a.views!=="object")return!1;if(a.models&&typeof a.models!=="object")return!1;if(a.templates&&typeof a.templates!=="object")return!1;return!0}function m(a,b,g,d){function e(){typeof d===
"function"&&d(f)}var l=n[a],f;if(l){var h={};$.extend(!0,h,l.opt,g);var m=new j.sandbox(b,h);f=l.creator(m);f.opt=h;$.each(q,function(a,c){c(b,h,m)});h.templates&&j.template?j.template.loadMultiple(h.templates).done(function(a){j.template.set(b,a);e()}).fail(function(){}).then(function(){delete h.templates}):e()}else(void 0)("could not start module '"+a+"' - module does not exist.",c)}function h(a,b){l(a,b,"error")}function l(a,b,c){if(j.log&&typeof j.log[c]==="function")j.log[c](a,b)}var j=this,
n={},k={},p={},q=[],j={register:function(b,c,g){if(!a(b,c,g))return!1;g||(g={});n[b]={creator:c,opt:g};return!0},onInstantiate:function(a){typeof a==="function"?q.push(a):h("onInstantiate expect a function as parameter",c)},start:f,startSubModule:function(a,c,g,d,e){a=b(a,c,g);f(a.moduleId,a.instanceId,a.opt,e)&&typeof d==="string"&&((d=p[d])||(d=[]),d.push(a.instanceId))},stop:e,startAll:function(a,b){function g(){}if(typeof a==="function")var d=0,d=$.isArray(b)?b.length:j.util.countObjectKeys(n),
g=function(){d--;d===0&&a()};$.isArray(b)?$.each(b,function(a,b){typeof b==="string"?f(b,b,n[b].opt,g):typeof b==="object"?b.j&&b.k?f(b.j,b.m,b.k,g):h("Could not start module from array - invalid parameters",c):h("Could not start module from array",c)}):$.each(n,function(a,b){b&&f(a,a,b.opt,g)})},stopAll:function(){$.each(k,function(a){e(a)})},publish:function(a,b,c){$.each(k,function(g,d){if(d.subscriptions){var e=d.subscriptions[a];e&&$.each(e,function(g,d){if(typeof d==="function")if(typeof b===
"object"&&c!==!0){var e={};$.extend(!0,e,b);d(e,a)}else d(b,a)})}})},subscribe:function(a,b,c){l("subscribe to '"+b+"'",a,"debug");a=k[a];a.subscriptions||(a.subscriptions={});a=a.subscriptions;a[b]||(a[b]=[]);a[b].push(c)},getContainer:function(a){var b=k[a].opt;if(b&&typeof b.container==="string")return $("#"+b.container);return $("#"+a)},getInstance:function(a){return k[a]},log:l};i[c]=i[c]||j})(window,"scaleApp");(function(i,c,e){function f(a,g,e){if(e)if(typeof g==="object"){f(a,e+":");f(a,g);return}else g=e+": "+g;switch(a){case b.d:d<=b.d&&c.debug(g);break;case b.c:d<=b.c&&c.info(g);break;case b.g:d<=b.g&&c.warn(g);break;case b.f:d<=b.f&&c.error(g);break;case b.e:d<=b.e&&c.error(g);break;default:c.log(g)}}c||(i=function(){},c={log:i,debug:i,info:i,warn:i,error:i,fatal:i});var d=0,b={d:0,c:1,g:2,f:3,e:4};e.log={debug:function(a,c){f(b.d,a,c)},info:function(a,c){f(b.c,a,c)},warn:function(a,c){f(b.g,a,c)},
error:function(a,c){f(b.f,a,c)},fatal:function(a,c){f(b.e,a,c)},setLogLevel:function(a){if(typeof a==="string")switch(a.toLowerCase()){case "debug":d=b.d;break;case "info":d=b.c;break;case "warn":d=b.g;break;case "error":d=b.f;break;case "fatal":d=b.e;break;default:d=b.c}else typeof a==="number"&&(d=a>=b.d&&a<=b.e?a:b.c)},getLogLevel:function(){return d}}})(window,window.console,window.scaleApp);(function(i,c){function e(){return(navigator.language||navigator.l||"en").split("-")[0]}var f=e();c.i18n=c.i18n||{setLanguage:function(d){if(typeof d==="string")return f=d,c.publish("languageChanged",d),!0;return!1},getBrowserLanguage:e,getLanguage:function(){return f},_:function(d,b){var a=c.getInstance(d);if(a.opt&&a.opt.i18n)return a.opt.i18n[f][b]||b;return b}}})(window,window.scaleApp);(function(i,c){c.util=c.util||{mixin:function(c,f){function d(b,a){var c={};$.extend(c,b,a);$.extend(a,c)}switch(typeof f+"-"+typeof c){case "function-function":d(f.prototype,c.prototype);break;case "function-object":d(f.prototype,c);break;case "object-object":d(f,c);break;case "object-function":d(f,c.prototype)}},countObjectKeys:function(c){var f=0;if(typeof c==="object")for(var d in c)f++;return f}}})(window,window.scaleApp);(function(i,c){function e(c){var b=$.Deferred();typeof c==="string"?$.get(c).done(function(a){b.resolve($('<script type="text/x-jquery-tmpl">'+a+"<\/script>").template())}).fail(function(){b.reject("Could not load the template")}):b.reject("function argument has to be a string");return b.promise()}var f={};c.template=c.template||{load:e,loadMultiple:function(c){function b(a){return function(b){f[a]=b}}var a=$.Deferred(),g=[],f={},h;for(h in c)g.push(e(c[h]).done(new b(h)));$.when.apply(null,g).done(function(){a.resolve(f)});
return a.promise()},get:function(c,b){var a=f[c];if(a){if(!b&&$(a).length===1){for(var g in a)break;return a[g]}return a[b]}},add:function(d,b,a){typeof d==="string"&&typeof b==="string"&&typeof a==="function"?(f[d]||(f[d]={}),f[d][b]=a):c.log.error("could not add template: invalid parameters","template")},set:function(d,b){typeof d==="string"&&typeof b==="object"?f[d]=b:c.log.error("could not set templates: invalid parameters","template")}}})(window,window.scaleApp);(function(i,c){function e(a,b,d){if(a=a[b]){if(!d&&c.util.countObjectKeys(a)===1){for(var g in a)break;return a[g]}return a[d]}}function f(a,b,c,d){a[b]||(a[b]={});a[b][c]=d}function d(a,b,c){typeof c==="object"&&$.each(c,function(c,d){d&&f(a,b,c,d)})}function b(b){typeof b==="object"&&$.each(b,function(b,d){d&&c.util.mixin(d,a)})}function a(){}a.prototype={subscribe:function(a){if(!this.b)this.b=[];this.b.push(a)},unsubscribe:function(a){if(this.b)this.b=this.b.filter(function(b){if(b!==a)return b})},
notify:function(){this.b&&$.each(this.b,function(a,b){typeof b.update==="function"&&b.update()})}};var g={},m={},h={};c.onInstantiate(function(a,c){c.models&&(b(c.models),d(g,a,c.models));c.views&&d(m,a,c.views);c.controllers&&d(h,a,c.controllers)});c.a=c.a||{addModel:function(a,b,c){f(g,a,b,c)},addView:function(a,b,c){f(m,a,b,c)},addController:function(a,b,c){f(h,a,b,c)},getModel:function(a,b){return e(g,a,b)},getView:function(a,b){return e(m,a,b)},getController:function(a,b){return e(h,a,b)},observable:a}})(window,
window.scaleApp);(function(i,c){c.sandbox=c.sandbox||function(e){function f(a){return c.template.get(e,a)}function d(a,b){c.publish(a,b)}var b={h:function(a){c.log.debug(a,e)},info:function(a){c.log.info(a,e)},warn:function(a){c.log.warn(a,e)},error:function(a){c.log.error(a,e)},i:function(a){c.log.fatal(a,e)}};return{subscribe:function(a,b){c.subscribe(e,a,b)},unsubscribe:function(a){c.unsubscribe(e,a)},publish:d,startSubModule:function(a,b,d,f){c.startSubModule(a,b,d,e,f)},stopSubModule:function(a){c.stop(a)},getModel:function(a){return c.a.getModel(e,
a)},getView:function(a){return c.a.getView(e,a)},getController:function(a){return c.a.getController(e,a)},addModel:function(a,b){return c.a.addModel(e,a,b)},addView:function(a,b){return c.a.addView(e,a,b)},addController:function(a,b){return c.a.addController(e,a,b)},observable:c.a.observable,getTemplate:f,tmpl:function(a,c){if(typeof a==="string")return $.tmpl(f(a),c);else if(typeof a==="function")return $.tmpl(a,c);else b.error("type of 'id' is not valid","sandbox of "+e)},getContainer:function(){return c.getContainer(e)},
debug:b.h,info:b.info,warn:b.warn,error:b.error,fatal:b.i,mixin:c.util.mixin,count:c.util.countObjectKeys,_:function(a){return c.i18n._(e,a)},getLanguage:c.i18n.getLanguage,hotkeys:function(a,b,c,e){typeof b==="string"?(e||(e="keypress"),$(document).bind(e,a,function(){d(b,c)})):typeof b==="function"&&(c||(c="keypress"),$(document).bind(c,a,b))}}}})(window,window.scaleApp);
