var scaleApp=function(){return function(){var b={},g={},i={},f={},n={},c=[],l=function(a,e,d,k,o){var r=g[a],s,t=function(){typeof k==="function"&&k(s)};if(r){var p={};$.extend(true,p,r.opt,d);a=new b.sandbox(b,e,p);s=r.creator(a);s.opt=p;for(var u in c)c[u](e,p,a);p.templates?v(e,p.templates,function(){delete p.templates;b.log.debug("templates loaded");t()},function(){delete p.templates;typeof o==="function"&&o(s)}):t()}else b.log.error("could not start module '"+a+"' - module does not exist.","core")},
h=function(a,e,d){if(typeof a!=="string"){b.log.error("could not register module- mouduleId has to be a string","core");return false}if(typeof e!=="function"){b.log.error("could not register module - creator has to be a constructor function","core");return false}a=e();if(typeof a!=="object"||typeof a.init!=="function"||typeof a.destroy!=="function"){b.log.error("could not register module - creator has to return an object with the functions 'init' and 'destroy'","core");return false}if(d){if(typeof d!==
"object"){b.log.error("could not register module - option has to be an object","core");d=false}else d=true;if(!d)return false}return true},j=function(a,e,d){if(typeof a==="string"&&(typeof e==="string"&&!d||typeof e==="object"&&!d||typeof e==="string"&&typeof d==="object"||!e&&!d)){if(typeof e==="object"&&!d){d=e;e=a}if(!e&&!d){e=a;d={}}return{moduleId:a,instanceId:e,opt:d}}b.log.error("could not start module '"+a+"' - illegal arguments.","core")},m=function(a,e,d){var k=j(a,e,d);if(k){b.log.debug("start '"+
k.moduleId+"'","core");l(k.moduleId,k.instanceId,k.opt,function(o){i[k.instanceId]=o;o.init()});return true}return false},q=function(a){var e=i[a];if(e){e.destroy();delete i[a];for(var d in f[a])f[a][d]&&q(f[a][d])}else b.log.error("could not stop instance '"+a+"' - instance does not exist.","core")},v=function(a,e,d,k){b.log.debug("loading templates...");var o=0,r=function(p){o--;typeof k==="function"?k(p):b.log.error("could not load template:"+p,"core");o<1&&typeof d==="function"&&d()},s=function(){b.log.debug("template loading successfull");
o--;b.log.debug(o+" templates left");o<1&&typeof d==="function"&&d()},t;for(t in e){o++;w(a,t,e[t],s,r)}},w=function(a,e,d,k){n[a]||(n[a]={});var o=function(r){n[a][e]=$('<script type="text/x-jquery-tmpl">'+r+"<\/script>").template();typeof k==="function"&&k()};typeof d==="string"&&$.get(d,o)};return b={register:function(a,e,d){if(!h(a,e,d))return false;d||(d={});g[a]={creator:e,opt:d};return true},onInstantiate:function(a){typeof a==="function"?c.push(a):b.log.error("scaleApp.onInstantiate expect a function as parameter",
"core")},start:m,startSubModule:function(a,e,d,k){a=j(a,e,d);if(m(a.moduleId,a.instanceId,a.opt)&&typeof k==="string"){(k=f[k])||(k=[]);k.push(a.instanceId)}},stop:q,startAll:function(){for(var a in g)g[a]&&m(a,a,g[a].opt)},stopAll:function(){for(var a in i)i.hasOwnProperty(a)&&q(a)},publish:function(a,e){for(var d in i)if(i[d].subscriptions){var k=i[d].subscriptions[a];if(k)for(var o in k)typeof k[o]==="function"&&k[o](a,e)}},subscribe:function(a,e,d){b.log.debug("subscribe to '"+e+"'",a);a=i[a];
if(!a.subscriptions)a.subscriptions={};a=a.subscriptions;a[e]||(a[e]=[]);a[e].push(d)},getTemplate:function(a,e){var d=n[a];if(d){if(!e&&$(d).length==1){for(var k in d)break;return d[k]}return d[e]}},getContainer:function(a){var e=i[a].opt;if(e)if(typeof e.container==="string")return $("#"+e.container);return $("#"+a)},getInstance:function(a){return i[a]},log:{debug:function(){},info:function(){},warn:function(){},error:function(){},fatal:function(){}}}}()}();scaleApp.sandbox=function(b,g){var i=function(c,l){b.publish(c,l)},f={debug:function(c){b.log.debug(c,g)},info:function(c){b.log.info(c,g)},warn:function(c){b.log.warn(c,g)},error:function(c){b.log.error(c,g)},fatal:function(c){b.log.fatal(c,g)}},n=function(c){return b.getTemplate(g,c)};return{subscribe:function(c,l){b.subscribe(g,c,l)},unsubscribe:function(c){b.unsubscribe(g,c)},publish:i,startSubModule:function(c,l,h){b.startSubModule(c,l,h,g)},stopSubModule:function(c){b.stop(c)},getModel:function(c){return b.mvc.getModel(g,
c)},getView:function(c){return b.mvc.getView(g,c)},getController:function(c){return b.mvc.getController(g,c)},addModel:function(c,l){return b.mvc.addModel(g,c,l)},addView:function(c,l){return b.mvc.addView(g,c,l)},addController:function(c,l){return b.mvc.addController(g,c,l)},getTemplate:n,tmpl:function(c,l){return $.tmpl(n(c),l)},getContainer:function(){return b.getContainer(g)},debug:f.debug,info:f.info,warn:f.warn,error:f.error,fatal:f.fatal,_:function(c){return b.i18n._(g,c)},hotkeys:function(c,
l,h,j){if(typeof l==="string"){j||(j="keypress");$(document).bind(j,c,function(){i(l,h)})}else if(typeof l==="function"){h||(h="keypress");$(document).bind(h,c,l)}}}};scaleApp.log=function(){if(!console){console={};console.log=function(){};console.debug=function(){};console.info=function(){};console.warn=function(){};console.error=function(){};console.fatal=function(){}}var b={DEBUG:0,INFO:1,WARN:2,ERROR:3,FATAL:4},g=function(i,f,n){if(n)if(typeof f==="object"){g(i,n+":");g(i,f);return}else f=n+": "+f;switch(i){case b.DEBUG:0<=b.DEBUG&&console.debug(f);break;case b.INFO:0<=b.INFO&&console.info(f);break;case b.WARN:0<=b.WARN&&console.warn(f);break;case b.ERROR:0<=
b.ERROR&&console.error(f);break;case b.FATAL:0<=b.FATAL&&console.error(f);break;default:console.log(f)}};return{debug:function(i,f){g(b.DEBUG,i,f)},info:function(i,f){g(b.INFO,i,f)},warn:function(i,f){g(b.WARN,i,f)},error:function(i,f){g(b.ERROR,i,f)},fatal:function(i,f){g(b.FATAL,i,f)}}}();scaleApp.i18n=function(b){var g=function(){return(navigator.language||navigator.browserLanguage||"en").split("-")[0]},i=g();return{setLanguage:function(f){if(typeof f==="string"){i=f;b.publish("languageChanged",f);return true}return false},getBrowserLanguage:g,getLanguage:function(){return i},_:function(f,n){var c=b.getInstance(f);if(c.opt)if(c.opt.i18n)return c.opt.i18n[i][n];return""}}}(scaleApp);scaleApp.mvc=function(b){var g={},i={},f={};b.onInstantiate(function(h,j){j.models&&n(g,h,j.models);j.views&&n(i,h,j.views);j.controllers&&n(f,h,j.controllers)});var n=function(h,j,m){if(typeof m==="object")for(var q in m)m[q]&&c(h,j,q,m[q])},c=function(h,j,m,q){h[j]||(h[j]={});h[j][m]=q},l=function(h,j,m){if(h=h[j]){if(!m&&$(h).length==1){for(var q in h)break;return h[q]}return h[m]}};return{addModel:function(h,j,m){c(g,h,j,m)},addView:function(h,j,m){c(i,h,j,m)},addController:function(h,j,m){c(f,
h,j,m)},getModel:function(h,j){return l(g,h,j)},getView:function(h,j){return l(i,h,j)},getController:function(h,j){return l(f,h,j)}}}(scaleApp);
